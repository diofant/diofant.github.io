

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>diofant.solvers.diophantine &mdash; Diofant 0.11.0a6.dev1+g92c4bf0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"CommonHTML": {"linebreaks": {"automatic": true}}, "HTML-CSS": {"linebreaks": {"automatic": true}}, "SVG": {"linebreaks": {"automatic": true}}})</script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Diofant
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../internals/index.html">Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guide.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutus.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sources.html">Bibliography</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Diofant</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>diofant.solvers.diophantine</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for diofant.solvers.diophantine</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">math</span>

<span class="kn">from</span> <span class="nn">..core</span> <span class="k">import</span> <span class="p">(</span><span class="n">Add</span><span class="p">,</span> <span class="n">Eq</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Mul</span><span class="p">,</span> <span class="n">Rational</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">,</span> <span class="n">factor_terms</span><span class="p">,</span>
                    <span class="n">igcd</span><span class="p">,</span> <span class="n">ilcm</span><span class="p">,</span> <span class="n">integer_nthroot</span><span class="p">,</span> <span class="n">oo</span><span class="p">,</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">sympify</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">..core.assumptions</span> <span class="k">import</span> <span class="n">check_assumptions</span>
<span class="kn">from</span> <span class="nn">..core.compatibility</span> <span class="k">import</span> <span class="n">as_int</span><span class="p">,</span> <span class="n">is_sequence</span>
<span class="kn">from</span> <span class="nn">..core.function</span> <span class="k">import</span> <span class="n">_mexpand</span>
<span class="kn">from</span> <span class="nn">..core.numbers</span> <span class="k">import</span> <span class="n">igcdex</span>
<span class="kn">from</span> <span class="nn">..core.power</span> <span class="k">import</span> <span class="n">isqrt</span>
<span class="kn">from</span> <span class="nn">..functions</span> <span class="k">import</span> <span class="n">floor</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">sqrt</span>
<span class="kn">from</span> <span class="nn">..matrices</span> <span class="k">import</span> <span class="n">Matrix</span>
<span class="kn">from</span> <span class="nn">..ntheory</span> <span class="k">import</span> <span class="p">(</span><span class="n">divisors</span><span class="p">,</span> <span class="n">factorint</span><span class="p">,</span> <span class="n">is_square</span><span class="p">,</span> <span class="n">isprime</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">,</span>
                       <span class="n">nextprime</span><span class="p">,</span> <span class="n">perfect_power</span><span class="p">,</span> <span class="n">sqrt_mod</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">..polys</span> <span class="k">import</span> <span class="n">GeneratorsNeeded</span><span class="p">,</span> <span class="n">Poly</span><span class="p">,</span> <span class="n">factor_list</span>
<span class="kn">from</span> <span class="nn">..simplify</span> <span class="k">import</span> <span class="n">signsimp</span>
<span class="kn">from</span> <span class="nn">..utilities</span> <span class="k">import</span> <span class="n">default_sort_key</span><span class="p">,</span> <span class="n">filldedent</span><span class="p">,</span> <span class="n">numbered_symbols</span>
<span class="kn">from</span> <span class="nn">.solvers</span> <span class="k">import</span> <span class="n">solve</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="s1">&#39;diophantine&#39;</span><span class="p">,</span> <span class="s1">&#39;classify_diop&#39;</span>

<span class="c1"># these types are known (but not necessarily handled)</span>
<span class="n">diop_known</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;binary_quadratic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cubic_thue&quot;</span><span class="p">,</span>
    <span class="s2">&quot;general_pythagorean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;general_sum_of_even_powers&quot;</span><span class="p">,</span>
    <span class="s2">&quot;general_sum_of_squares&quot;</span><span class="p">,</span>
    <span class="s2">&quot;homogeneous_general_quadratic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;homogeneous_ternary_quadratic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;homogeneous_ternary_quadratic_normal&quot;</span><span class="p">,</span>
    <span class="s2">&quot;inhomogeneous_general_quadratic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;inhomogeneous_ternary_quadratic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="s2">&quot;univariate&quot;</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">_is_int</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">as_int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>


<span class="k">def</span> <span class="nf">_sorted_tuple</span><span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_remove_gcd</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">igcd</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">i</span><span class="o">//</span><span class="n">g</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>


<span class="k">def</span> <span class="nf">_rational_pq</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="c1"># return `(numer, denom)` for a/b; sign in numer and gcd removed</span>
    <span class="k">return</span> <span class="n">_remove_gcd</span><span class="p">(</span><span class="n">sign</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_nint_or_floor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
    <span class="c1"># return nearest int to p/q; in case of tie return floor(p/q)</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">w</span>
    <span class="k">return</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">1</span>


<span class="k">def</span> <span class="nf">_odd</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span>


<span class="k">def</span> <span class="nf">_even</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>


<div class="viewcode-block" id="diophantine"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.diophantine">[docs]</a><span class="k">def</span> <span class="nf">diophantine</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">syms</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simplify the solution procedure of diophantine equation ``eq`` by</span>
<span class="sd">    converting it into a product of terms which should equal zero.</span>

<span class="sd">    `(x + y)(x - y) = 0` and `x + y = 0` and `x - y = 0` are solved</span>
<span class="sd">    independently and combined. Each term is solved by calling</span>
<span class="sd">    ``diop_solve()``.</span>

<span class="sd">    Output of ``diophantine()`` is a set of tuples. The elements of the</span>
<span class="sd">    tuple are the solutions for each variable in the the equation and</span>
<span class="sd">    are arranged according to the alphabetic ordering of the variables.</span>
<span class="sd">    e.g. For an equation with two variables, `a` and `b`, the first</span>
<span class="sd">    element of the tuple is the solution for `a` and the second for `b`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    eq : Relational or Expr</span>
<span class="sd">        an equation (to be solved)</span>
<span class="sd">    t : Symbol, optional</span>
<span class="sd">        the parameter to be used in the solution.</span>
<span class="sd">    syms : list of Symbol&#39;s, optional</span>
<span class="sd">        which determines the order of the elements in the returned tuple.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; diophantine(x**2 - y**2)</span>
<span class="sd">    {(t_0, -t_0), (t_0, t_0)}</span>

<span class="sd">    &gt;&gt;&gt; diophantine(x*(2*x + 3*y - z))</span>
<span class="sd">    {(0, n1, n2), (t_0, t_1, 2*t_0 + 3*t_1)}</span>
<span class="sd">    &gt;&gt;&gt; diophantine(x**2 + 3*x*y + 4*x)</span>
<span class="sd">    {(0, n1), (3*t_0 - 4, -t_0)}</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.solvers.diophantine.diop_solve</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">Eq</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">lhs</span> <span class="o">-</span> <span class="n">eq</span><span class="o">.</span><span class="n">rhs</span>

    <span class="k">if</span> <span class="n">eq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{(</span><span class="n">param</span><span class="p">,)}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">var</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">eq</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">)</span>
        <span class="n">var</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">default_sort_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">syms</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_sequence</span><span class="p">(</span><span class="n">syms</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;syms should be given as a sequence, e.g. a list&#39;</span><span class="p">)</span>
            <span class="n">syms</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">syms</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">var</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">syms</span> <span class="o">!=</span> <span class="n">var</span><span class="p">:</span>
                <span class="nb">map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">syms</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">syms</span><span class="p">))))</span>
                <span class="k">return</span> <span class="p">{</span><span class="nb">tuple</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="nb">map</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">var</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">diophantine</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">param</span><span class="p">)}</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">as_numer_denom</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">:</span>
            <span class="n">dsol</span> <span class="o">=</span> <span class="n">diophantine</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="n">good</span> <span class="o">=</span> <span class="n">diophantine</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">dsol</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">good</span> <span class="k">if</span> <span class="n">_mexpand</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">s</span><span class="p">)))}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">eq</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="n">factor_terms</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">eq</span><span class="o">.</span><span class="n">is_number</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">as_independent</span><span class="p">(</span><span class="o">*</span><span class="n">var</span><span class="p">,</span> <span class="n">as_Add</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Poly</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">is_number</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">gens</span><span class="p">)</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">eq</span><span class="o">.</span><span class="n">is_polynomial</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">GeneratorsNeeded</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Equation should be a polynomial with &quot;</span>
                        <span class="s2">&quot;Rational coefficients.&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># if we know that factoring should not be attempted, skip</span>
        <span class="c1"># the factoring step</span>
        <span class="n">v</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s1">&#39;general_sum_of_squares&#39;</span><span class="p">:</span>
            <span class="c1"># trying to factor such expressions will sometimes hang</span>
            <span class="n">terms</span> <span class="o">=</span> <span class="p">[(</span><span class="n">eq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">NotImplementedError</span><span class="p">):</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="n">factor_list</span><span class="p">(</span><span class="n">eq</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">sols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>

        <span class="n">base</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">term</span>
        <span class="n">var_t</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">eq_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="n">signsimp</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">as_coeff_Mul</span><span class="p">()</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="n">diop_solve</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">eq_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="s2">&quot;homogeneous_ternary_quadratic&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;homogeneous_ternary_quadratic_normal&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;general_pythagorean&quot;</span><span class="p">]:</span>
            <span class="n">sols</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">merge_solution</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">var_t</span><span class="p">,</span> <span class="n">solution</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">eq_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;binary_quadratic&quot;</span><span class="p">,</span> <span class="s2">&quot;general_sum_of_squares&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;general_sum_of_even_powers&quot;</span><span class="p">,</span> <span class="s2">&quot;univariate&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">sol</span> <span class="ow">in</span> <span class="n">solution</span><span class="p">:</span>
                <span class="n">sols</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">merge_solution</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">var_t</span><span class="p">,</span> <span class="n">sol</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;unhandled type: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">eq_type</span><span class="p">)</span>

    <span class="c1"># remove null merge results</span>
    <span class="k">if</span> <span class="p">()</span> <span class="ow">in</span> <span class="n">sols</span><span class="p">:</span>
        <span class="n">sols</span><span class="o">.</span><span class="n">remove</span><span class="p">(())</span>

    <span class="n">null</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
    <span class="c1"># if there is no solution, return trivial solution</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sols</span> <span class="ow">and</span> <span class="n">eq</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">null</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sols</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">null</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="n">sympify</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sols</span><span class="p">}</span></div>


<div class="viewcode-block" id="merge_solution"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.merge_solution">[docs]</a><span class="k">def</span> <span class="nf">merge_solution</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">var_t</span><span class="p">,</span> <span class="n">solution</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is used to construct the full solution from the solutions of sub</span>
<span class="sd">    equations.</span>

<span class="sd">    For example when solving the equation `(x - y)(x^2 + y^2 - z^2) = 0`,</span>
<span class="sd">    solutions for each of the equations `x - y = 0` and `x^2 + y^2 - z^2` are</span>
<span class="sd">    found independently. Solutions for `x - y = 0` are `(x, y) = (t, t)`. But</span>
<span class="sd">    we should introduce a value for z when we output the solution for the</span>
<span class="sd">    original equation. This function converts `(t, t)` into `(t, t, n_{1})`</span>
<span class="sd">    where `n_{1}` is an integer parameter.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sol</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">solution</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">()</span>

    <span class="n">solution</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">numbered_symbols</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var_t</span><span class="p">:</span>
            <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">solution</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">symb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">check_assumptions</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="o">**</span><span class="n">symb</span><span class="o">.</span><span class="n">_assumptions</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">()</span>

    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span></div>


<div class="viewcode-block" id="diop_solve"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.diop_solve">[docs]</a><span class="k">def</span> <span class="nf">diop_solve</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves the diophantine equation ``eq``.</span>

<span class="sd">    Unlike ``diophantine()``, factoring of ``eq`` is not attempted. Uses</span>
<span class="sd">    ``classify_diop()`` to determine the type of the equation and calls</span>
<span class="sd">    the appropriate solver function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    eq : Expr</span>
<span class="sd">       an expression, which is assumed to be zero.</span>
<span class="sd">    t : Symbol, optional</span>
<span class="sd">       a parameter, to be used in the solution.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from diofant.abc import w</span>
<span class="sd">    &gt;&gt;&gt; diop_solve(2*x + 3*y - 5)</span>
<span class="sd">    (3*t_0 - 5, -2*t_0 + 5)</span>
<span class="sd">    &gt;&gt;&gt; diop_solve(4*x + 3*y -4*z + 5)</span>
<span class="sd">    (t_0, 8*t_0 + 4*t_1 + 5, 7*t_0 + 3*t_1 + 5)</span>
<span class="sd">    &gt;&gt;&gt; diop_solve(x + 3*y - 4*z + w -6)</span>
<span class="sd">    (t_0, t_0 + t_1, 6*t_0 + 5*t_1 + 4*t_2 - 6, 5*t_0 + 4*t_1 + 3*t_2 - 6)</span>
<span class="sd">    &gt;&gt;&gt; diop_solve(x**2 + y**2 - 5)</span>
<span class="sd">    {(-2, -1), (-2, 1), (-1, -2), (-1, 2), (1, -2), (1, 2), (2, -1), (2, 1)}</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.solvers.diophantine.diophantine</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">eq_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">eq_type</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_diop_linear</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">eq_type</span> <span class="o">==</span> <span class="s2">&quot;binary_quadratic&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_diop_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">eq_type</span> <span class="o">==</span> <span class="s2">&quot;homogeneous_ternary_quadratic&quot;</span><span class="p">:</span>
        <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">_diop_ternary_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_parametrize_ternary_quadratic</span><span class="p">((</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">),</span> <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">eq_type</span> <span class="o">==</span> <span class="s2">&quot;homogeneous_ternary_quadratic_normal&quot;</span><span class="p">:</span>
        <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">_diop_ternary_quadratic_normal</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_parametrize_ternary_quadratic</span><span class="p">((</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">),</span> <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">eq_type</span> <span class="o">==</span> <span class="s2">&quot;general_pythagorean&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_diop_general_pythagorean</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">eq_type</span> <span class="o">==</span> <span class="s2">&quot;univariate&quot;</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">soln</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
            <span class="n">soln</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">soln</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">soln</span><span class="p">,</span> <span class="n">Integer</span><span class="p">):</span>
                <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">soln</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">elif</span> <span class="n">eq_type</span> <span class="o">==</span> <span class="s2">&quot;general_sum_of_squares&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_diop_general_sum_of_squares</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">limit</span><span class="o">=</span><span class="n">oo</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">eq_type</span> <span class="o">==</span> <span class="s2">&quot;general_sum_of_even_powers&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">coeff</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">is_Pow</span> <span class="ow">and</span> <span class="n">coeff</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">exp</span>
        <span class="k">return</span> <span class="n">_diop_general_sum_of_even_powers</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">limit</span><span class="o">=</span><span class="n">oo</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">eq_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">eq_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">diop_known</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">filldedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    Alhough this type of equation was identified, it is not yet</span>
<span class="s1">    handled. It should, however, be listed in `diop_known` at the</span>
<span class="s1">    top of this file. Developers should see comments at the end of</span>
<span class="s1">    `classify_diop`.</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">))</span>  <span class="c1"># pragma: no cover</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;No solver has been written for </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="n">eq_type</span><span class="p">)</span></div>


<div class="viewcode-block" id="classify_diop"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.classify_diop">[docs]</a><span class="k">def</span> <span class="nf">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper routine used by diop_solve() to find the type of the ``eq`` etc.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    eq : Expr</span>
<span class="sd">        an expression, which is assumed to be zero.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from diofant.abc import w</span>
<span class="sd">    &gt;&gt;&gt; classify_diop(4*x + 6*y - 4)</span>
<span class="sd">    ([x, y], {1: -4, x: 4, y: 6}, &#39;linear&#39;)</span>
<span class="sd">    &gt;&gt;&gt; classify_diop(x + 3*y -4*z + 5)</span>
<span class="sd">    ([x, y, z], {1: 5, x: 1, y: 3, z: -4}, &#39;linear&#39;)</span>
<span class="sd">    &gt;&gt;&gt; classify_diop(x**2 + y**2 - x*y + x + 5)</span>
<span class="sd">    ([x, y], {1: 5, x: 1, x**2: 1, y**2: 1, x*y: -1}, &#39;binary_quadratic&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">var</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">eq</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">var</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;equation should have 1 or more free symbols&#39;</span><span class="p">)</span>
    <span class="n">var</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">default_sort_key</span><span class="p">)</span>
    <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">coeff</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">as_coefficients_dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">_is_int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">coeff</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Coefficients should be Integers&quot;</span><span class="p">)</span>

    <span class="n">diop_type</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">total_degree</span> <span class="o">=</span> <span class="n">Poly</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span><span class="o">.</span><span class="n">total_degree</span><span class="p">()</span>
    <span class="n">homogeneous</span> <span class="o">=</span> <span class="mi">1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">coeff</span>
    <span class="k">if</span> <span class="n">total_degree</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">diop_type</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>

    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">diop_type</span> <span class="o">=</span> <span class="s2">&quot;univariate&quot;</span>

    <span class="k">elif</span> <span class="n">total_degree</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">diop_type</span> <span class="o">=</span> <span class="s2">&quot;binary_quadratic&quot;</span>

    <span class="k">elif</span> <span class="n">total_degree</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">homogeneous</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
            <span class="n">diop_type</span> <span class="o">=</span> <span class="s2">&quot;inhomogeneous_ternary_quadratic&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nonzero</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">coeff</span> <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nonzero</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="ow">in</span> <span class="n">nonzero</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">var</span><span class="p">):</span>
                <span class="n">diop_type</span> <span class="o">=</span> <span class="s2">&quot;homogeneous_ternary_quadratic_normal&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">diop_type</span> <span class="o">=</span> <span class="s2">&quot;homogeneous_ternary_quadratic&quot;</span>

    <span class="k">elif</span> <span class="n">total_degree</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
            <span class="n">diop_type</span> <span class="o">=</span> <span class="s2">&quot;inhomogeneous_general_quadratic&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># there may be Pow keys like x**2 or Mul keys like x*y</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">is_Mul</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">coeff</span><span class="p">):</span>  <span class="c1"># cross terms</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">homogeneous</span><span class="p">:</span>
                    <span class="n">diop_type</span> <span class="o">=</span> <span class="s2">&quot;inhomogeneous_general_quadratic&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">diop_type</span> <span class="o">=</span> <span class="s2">&quot;homogeneous_general_quadratic&quot;</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># all squares: x**2 + y**2 + ... + constant</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">coeff</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">diop_type</span> <span class="o">=</span> <span class="s2">&quot;general_sum_of_squares&quot;</span>
                <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="n">is_square</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">coeff</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">sign</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">coeff</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="c1"># all but one has the same sign</span>
                        <span class="c1"># e.g. 4*x**2 + y**2 - 4*z**2</span>
                        <span class="n">diop_type</span> <span class="o">=</span> <span class="s2">&quot;general_pythagorean&quot;</span>

    <span class="k">elif</span> <span class="n">total_degree</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">diop_type</span> <span class="o">=</span> <span class="s2">&quot;cubic_thue&quot;</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">total_degree</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">total_degree</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span>
          <span class="nb">all</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">is_Pow</span> <span class="ow">and</span> <span class="n">k</span><span class="o">.</span><span class="n">exp</span> <span class="o">==</span> <span class="n">total_degree</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">coeff</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">coeff</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">diop_type</span> <span class="o">=</span> <span class="s1">&#39;general_sum_of_even_powers&#39;</span>

    <span class="k">if</span> <span class="n">diop_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">var</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span> <span class="k">if</span> <span class="n">_dict</span> <span class="k">else</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span>

    <span class="c1"># new diop type instructions</span>
    <span class="c1"># --------------------------</span>
    <span class="c1"># if this error raises and the equation *can* be classified,</span>
    <span class="c1">#  * it should be identified in the if-block above</span>
    <span class="c1">#  * the type should be added to the diop_known</span>
    <span class="c1"># if a solver can be written for it,</span>
    <span class="c1">#  * a dedicated handler should be written (e.g. diop_linear)</span>
    <span class="c1">#  * it should be passed to that handler in diop_solve</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">filldedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        This equation is not yet recognized or else has not been</span>
<span class="s1">        simplified sufficiently to put it in a form recognized by</span>
<span class="s1">        diop_classify().&#39;&#39;&#39;</span><span class="p">))</span></div>


<span class="n">classify_diop</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Returns</span>
<span class="s2">    =======</span>

<span class="s2">    Returns a tuple containing the type of the diophantine equation along with</span>
<span class="s2">    the variables(free symbols) and their coefficients. Variables are returned</span>
<span class="s2">    as a list and coefficients are returned as a dict with the key being the</span>
<span class="s2">    respective term and the constant term is keyed to Integer(1).  The type</span>
<span class="s2">    is one of the following:</span>

<span class="s2">        * </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">        * &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">diop_known</span><span class="p">)))</span>


<div class="viewcode-block" id="diop_linear"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.diop_linear">[docs]</a><span class="k">def</span> <span class="nf">diop_linear</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves linear diophantine equations.</span>

<span class="sd">    A linear diophantine equation is an equation of the form `a_{1}x_{1} +</span>
<span class="sd">    a_{2}x_{2} + .. + a_{n}x_{n} = 0` where `a_{1}, a_{2}, ..a_{n}` are</span>
<span class="sd">    integer constants and `x_{1}, x_{2}, ..x_{n}` are integer variables.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    eq : Expr</span>
<span class="sd">       is a linear diophantine equation which is assumed to be zero.</span>
<span class="sd">    param : Symbol, optional</span>
<span class="sd">       is the parameter to be used in the solution.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; diop_linear(2*x - 3*y - 5)</span>
<span class="sd">    (3*t_0 - 5, 2*t_0 - 5)</span>

<span class="sd">    Here x = -3*t_0 - 5 and y = -2*t_0 - 5</span>

<span class="sd">    &gt;&gt;&gt; diop_linear(2*x - 3*y - 4*z - 3)</span>
<span class="sd">    (t_0, 2*t_0 + 4*t_1 + 3, -t_0 - 3*t_1 - 3)</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.solvers.diophantine.diop_quadratic</span>
<span class="sd">    diofant.solvers.diophantine.diop_ternary_quadratic</span>
<span class="sd">    diofant.solvers.diophantine.diop_general_pythagorean</span>
<span class="sd">    diofant.solvers.diophantine.diop_general_sum_of_squares</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">diop_type</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_diop_linear</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_diop_linear</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves diophantine equations of the form:</span>

<span class="sd">    a_0*x_0 + a_1*x_1 + ... + a_n*x_n == c</span>

<span class="sd">    Note that no solution exists if gcd(a_0, ..., a_n) doesn&#39;t divide c.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">coeff</span><span class="p">:</span>
        <span class="c1"># negate coeff[] because input is of the form: ax + by + c ==  0</span>
        <span class="c1">#                              but is used as: ax + by     == -c</span>
        <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="n">coeff</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Some solutions will have multiple free variables in their solutions.</span>
    <span class="k">if</span> <span class="n">param</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_</span><span class="si">%i</span><span class="s2">&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">symbols</span><span class="p">(</span><span class="n">temp</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">))]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">q</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">q</span><span class="p">,</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    base_solution_linear() can solve diophantine equations of the form:</span>

<span class="sd">    a*x + b*y == c</span>

<span class="sd">    We break down multivariate linear diophantine equations into a</span>
<span class="sd">    series of bivariate linear diophantine equations which can then</span>
<span class="sd">    be solved individually by base_solution_linear().</span>

<span class="sd">    Consider the following:</span>

<span class="sd">    a_0*x_0 + a_1*x_1 + a_2*x_2 == c</span>

<span class="sd">    which can be re-written as:</span>

<span class="sd">    a_0*x_0 + g_0*y_0 == c</span>

<span class="sd">    where</span>

<span class="sd">    g_0 == gcd(a_1, a_2)</span>

<span class="sd">    and</span>

<span class="sd">    y == (a_1*x_1)/g_0 + (a_2*x_2)/g_0</span>

<span class="sd">    This leaves us with two binary linear diophantine equations.</span>
<span class="sd">    For the first equation:</span>

<span class="sd">    a == a_0</span>
<span class="sd">    b == g_0</span>
<span class="sd">    c == c</span>

<span class="sd">    For the second:</span>

<span class="sd">    a == a_1/g_0</span>
<span class="sd">    b == a_2/g_0</span>
<span class="sd">    c == the solution we find for y_0 in the first equation.</span>

<span class="sd">    The arrays A and B are the arrays of integers used for</span>
<span class="sd">    &#39;a&#39; and &#39;b&#39; in each of the n-1 bivariate equations we solve.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">A</span> <span class="o">=</span> <span class="p">[</span><span class="n">coeff</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var</span><span class="p">]</span>
    <span class="n">B</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">B</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">gcd</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="n">gcd</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">//</span> <span class="n">gcd</span>
            <span class="n">B</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gcd</span><span class="p">)</span>
    <span class="n">B</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Consider the trivariate linear equation:</span>

<span class="sd">    4*x_0 + 6*x_1 + 3*x_2 == 2</span>

<span class="sd">    This can be re-written as:</span>

<span class="sd">    4*x_0 + 3*y_0 == 2</span>

<span class="sd">    where</span>

<span class="sd">    y_0 == 2*x_1 + x_2</span>
<span class="sd">    (Note that gcd(3, 6) == 3)</span>

<span class="sd">    The complete integral solution to this equation is:</span>

<span class="sd">    x_0 ==  2 + 3*t_0</span>
<span class="sd">    y_0 == -2 - 4*t_0</span>

<span class="sd">    where &#39;t_0&#39; is any integer.</span>

<span class="sd">    Now that we have a solution for &#39;x_0&#39;, find &#39;x_1&#39; and &#39;x_2&#39;:</span>

<span class="sd">    2*x_1 + x_2 == -2 - 4*t_0</span>

<span class="sd">    We can then solve for &#39;-2&#39; and &#39;-4&#39; independently,</span>
<span class="sd">    and combine the results:</span>

<span class="sd">    2*x_1a + x_2a == -2</span>
<span class="sd">    x_1a == 0 + t_0</span>
<span class="sd">    x_2a == -2 - 2*t_0</span>

<span class="sd">    2*x_1b + x_2b == -4*t_0</span>
<span class="sd">    x_1b == 0*t_0 + t_1</span>
<span class="sd">    x_2b == -4*t_0 - 2*t_1</span>

<span class="sd">    ==&gt;</span>

<span class="sd">    x_1 == t_0 + t_1</span>
<span class="sd">    x_2 == -2 - 6*t_0 - 2*t_1</span>

<span class="sd">    where &#39;t_0&#39; and &#39;t_1&#39; are any integers.</span>

<span class="sd">    Note that:</span>

<span class="sd">    4*(2 + 3*t_0) + 6*(t_0 + t_1) + 3*(-2 - 6*t_0 - 2*t_1) == 2</span>

<span class="sd">    for any integral values of &#39;t_0&#39;, &#39;t_1&#39;; as required.</span>

<span class="sd">    This method is generalized for many variables, below.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">solutions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">)):</span>
        <span class="n">tot_x</span><span class="p">,</span> <span class="n">tot_y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Add</span><span class="o">.</span><span class="n">make_args</span><span class="p">(</span><span class="n">c</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Integer</span><span class="p">:</span>
                <span class="c1"># example: 5 -&gt; k = 5</span>
                <span class="n">k</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">arg</span><span class="p">,</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">pnew</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># arg is a Mul or Symbol</span>
                <span class="c1"># example: 3*t_1 -&gt; k = 3</span>
                <span class="c1"># example: t_0 -&gt; k = 1</span>
                <span class="n">k</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">as_coeff_Mul</span><span class="p">()</span>
                <span class="n">pnew</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">params</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

            <span class="n">sol</span> <span class="o">=</span> <span class="n">sol_x</span><span class="p">,</span> <span class="n">sol_y</span> <span class="o">=</span> <span class="n">base_solution_linear</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pnew</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">sol</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># convert a + b*pnew -&gt; a*p + b*pnew</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sol_x</span><span class="p">,</span> <span class="n">Add</span><span class="p">):</span>
                    <span class="n">sol_x</span> <span class="o">=</span> <span class="n">sol_x</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">p</span> <span class="o">+</span> <span class="n">sol_x</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sol_y</span><span class="p">,</span> <span class="n">Add</span><span class="p">):</span>
                    <span class="n">sol_y</span> <span class="o">=</span> <span class="n">sol_y</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">p</span> <span class="o">+</span> <span class="n">sol_y</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">tot_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sol_x</span><span class="p">)</span>
            <span class="n">tot_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sol_y</span><span class="p">)</span>

        <span class="n">solutions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Add</span><span class="p">(</span><span class="o">*</span><span class="n">tot_x</span><span class="p">))</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Add</span><span class="p">(</span><span class="o">*</span><span class="n">tot_y</span><span class="p">)</span>

    <span class="n">solutions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">param</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># just keep the additive constant (i.e. replace t with 0)</span>
        <span class="n">solutions</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">as_coeff_Add</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">solutions</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span>


<div class="viewcode-block" id="base_solution_linear"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.base_solution_linear">[docs]</a><span class="k">def</span> <span class="nf">base_solution_linear</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the base solution for the linear equation, `ax + by = c`.</span>

<span class="sd">    Used by ``diop_linear()`` to find the base solution of a linear</span>
<span class="sd">    Diophantine equation. If ``t`` is given then the parametrized solution is</span>
<span class="sd">    returned.</span>

<span class="sd">    ``base_solution_linear(c, a, b, t)``: ``a``, ``b``, ``c`` are coefficients</span>
<span class="sd">    in `ax + by = c` and ``t`` is the parameter to be used in the solution.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; base_solution_linear(5, 2, 3)  # equation 2*x + 3*y = 5</span>
<span class="sd">    (-5, 5)</span>
<span class="sd">    &gt;&gt;&gt; base_solution_linear(0, 5, 7)  # equation 5*x + 7*y = 0</span>
<span class="sd">    (0, 0)</span>
<span class="sd">    &gt;&gt;&gt; base_solution_linear(5, 2, 3, t)  # equation 2*x + 3*y = 5</span>
<span class="sd">    (3*t - 5, -2*t + 5)</span>
<span class="sd">    &gt;&gt;&gt; base_solution_linear(0, 5, 7, t)  # equation 5*x + 7*y = 0</span>
<span class="sd">    (7*t, -5*t)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">_remove_gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="o">-</span><span class="n">t</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">igcdex</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>

        <span class="n">x0</span> <span class="o">*=</span> <span class="n">sign</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">y0</span> <span class="o">*=</span> <span class="n">sign</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">divisible</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="o">-</span><span class="n">t</span>
                <span class="k">return</span> <span class="n">c</span><span class="o">*</span><span class="n">x0</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="n">c</span><span class="o">*</span><span class="n">y0</span> <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">t</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">c</span><span class="o">*</span><span class="n">x0</span><span class="p">,</span> <span class="n">c</span><span class="o">*</span><span class="n">y0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="divisible"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.divisible">[docs]</a><span class="k">def</span> <span class="nf">divisible</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns `True` if ``a`` is divisible by ``b`` and `False` otherwise.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span></div>


<div class="viewcode-block" id="diop_quadratic"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.diop_quadratic">[docs]</a><span class="k">def</span> <span class="nf">diop_quadratic</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves quadratic diophantine equations.</span>

<span class="sd">    i.e. equations of the form `Ax^2 + Bxy + Cy^2 + Dx + Ey + F = 0`. Returns a</span>
<span class="sd">    set containing the tuples `(x, y)` which contains the solutions. If there</span>
<span class="sd">    are no solutions then `(None, None)` is returned.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    eq : Expr</span>
<span class="sd">        should be a quadratic bivariate expression which is assumed</span>
<span class="sd">        to be zero.</span>
<span class="sd">    param : Symbol, optional</span>
<span class="sd">        is a parameter to be used in the solution.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; diop_quadratic(x**2 + y**2 + 2*x + 2*y + 2, t)</span>
<span class="sd">    {(-1, -1)}</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    * Methods to solve Ax^2 + Bxy + Cy^2 + Dx + Ey + F = 0, [online],</span>
<span class="sd">      Available: https://www.alpertron.com.ar/METHODS.HTM</span>
<span class="sd">    * Solving the equation ax^2+ bxy + cy^2 + dx + ey + f= 0, [online],</span>
<span class="sd">      Available: https://web.archive.org/web/20180831180321/http://www.jpr2718.org/ax2p.pdf</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.solvers.diophantine.diop_linear</span>
<span class="sd">    diofant.solvers.diophantine.diop_ternary_quadratic</span>
<span class="sd">    diofant.solvers.diophantine.diop_general_sum_of_squares</span>
<span class="sd">    diofant.solvers.diophantine.diop_general_pythagorean</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">diop_type</span> <span class="o">==</span> <span class="s2">&quot;binary_quadratic&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_diop_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_diop_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">var</span>

    <span class="n">A</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">F</span> <span class="o">=</span> <span class="p">[</span><span class="n">as_int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">_remove_gcd</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">F</span><span class="p">)]</span>

    <span class="c1"># (1) Simple-Hyperbolic case: A = C = 0, B != 0</span>
    <span class="c1"># In this case equation can be converted to (Bx + E)(By + D) = DE - BF</span>
    <span class="c1"># We consider two cases; DE - BF = 0 and DE - BF != 0</span>
    <span class="c1"># More details, https://www.alpertron.com.ar/METHODS.HTM#SHyperb</span>

    <span class="n">sol</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">discr</span> <span class="o">=</span> <span class="n">B</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">C</span>
    <span class="k">if</span> <span class="n">A</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">C</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">B</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">D</span><span class="o">*</span><span class="n">E</span> <span class="o">-</span> <span class="n">B</span><span class="o">*</span><span class="n">F</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">q</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">sol</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="o">-</span><span class="n">q</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
            <span class="n">q</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">sol</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="n">q</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">div</span> <span class="o">=</span> <span class="n">divisors</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">E</span> <span class="o">-</span> <span class="n">B</span><span class="o">*</span><span class="n">F</span><span class="p">)</span>
            <span class="n">div</span> <span class="o">=</span> <span class="n">div</span> <span class="o">+</span> <span class="p">[</span><span class="o">-</span><span class="n">term</span> <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">div</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">div</span><span class="p">:</span>
                <span class="n">x0</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">E</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="p">:</span>
                    <span class="n">q</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">E</span> <span class="o">-</span> <span class="n">B</span><span class="o">*</span><span class="n">F</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="ow">not</span> <span class="n">r</span>
                    <span class="n">y0</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="p">:</span>
                        <span class="n">sol</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">))</span>

    <span class="c1"># (2) Parabolic case: B**2 - 4*A*C = 0</span>
    <span class="c1"># There are two subcases to be considered in this case.</span>
    <span class="c1"># sqrt(c)D - sqrt(a)E = 0 and sqrt(c)D - sqrt(a)E != 0</span>
    <span class="c1"># More Details, https://www.alpertron.com.ar/METHODS.HTM#Parabol</span>

    <span class="k">elif</span> <span class="n">discr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">A</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">_diop_quadratic</span><span class="p">([</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">],</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">soln</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                <span class="n">sol</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">soln</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">soln</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">A</span> <span class="o">//</span> <span class="n">g</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">C</span> <span class="o">//</span> <span class="n">g</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">B</span><span class="o">/</span><span class="n">A</span><span class="p">)</span>
            <span class="n">sqa</span> <span class="o">=</span> <span class="n">isqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">sqc</span> <span class="o">=</span> <span class="n">isqrt</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="n">_c</span> <span class="o">=</span> <span class="n">e</span><span class="o">*</span><span class="n">sqc</span><span class="o">*</span><span class="n">D</span> <span class="o">-</span> <span class="n">sqa</span><span class="o">*</span><span class="n">E</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_c</span><span class="p">:</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">extended_real</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">roots</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">sqa</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">D</span><span class="o">*</span><span class="n">z</span> <span class="o">+</span> <span class="n">sqa</span><span class="o">*</span><span class="n">F</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">roots</span><span class="p">:</span>
                    <span class="n">root</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="n">z</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">Integer</span><span class="p">):</span>
                        <span class="n">ans</span> <span class="o">=</span> <span class="n">diop_solve</span><span class="p">(</span><span class="n">sqa</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">e</span><span class="o">*</span><span class="n">sqc</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">root</span><span class="p">)</span>
                        <span class="n">sol</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">ans</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ans</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">def</span> <span class="nf">solve_x</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
                    <span class="k">return</span> <span class="o">-</span><span class="n">e</span><span class="o">*</span><span class="n">sqc</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">_c</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">e</span><span class="o">*</span><span class="n">sqc</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">t</span> <span class="o">-</span> <span class="p">(</span><span class="n">e</span><span class="o">*</span><span class="n">sqc</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">E</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">e</span><span class="o">*</span><span class="n">sqc</span><span class="o">*</span><span class="n">F</span><span class="p">)</span> <span class="o">//</span> <span class="n">_c</span>

                <span class="k">def</span> <span class="nf">solve_y</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">sqa</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">_c</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">sqa</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="p">(</span><span class="n">sqa</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">D</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">sqa</span><span class="o">*</span><span class="n">F</span><span class="p">)</span> <span class="o">//</span> <span class="n">_c</span>

                <span class="k">for</span> <span class="n">z0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">_c</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">divisible</span><span class="p">(</span><span class="n">sqa</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">z0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">D</span><span class="o">*</span><span class="n">z0</span> <span class="o">+</span> <span class="n">sqa</span><span class="o">*</span><span class="n">F</span><span class="p">,</span> <span class="n">_c</span><span class="p">)</span> <span class="ow">and</span>
                            <span class="n">divisible</span><span class="p">(</span><span class="n">e</span><span class="o">*</span><span class="n">sqc</span><span class="o">**</span><span class="n">g</span><span class="o">*</span><span class="n">z0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">E</span><span class="o">*</span><span class="n">z0</span> <span class="o">+</span> <span class="n">e</span><span class="o">*</span><span class="n">sqc</span><span class="o">*</span><span class="n">F</span><span class="p">,</span> <span class="n">_c</span><span class="p">)):</span>
                        <span class="n">sol</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">solve_x</span><span class="p">(</span><span class="n">z0</span><span class="p">),</span> <span class="n">solve_y</span><span class="p">(</span><span class="n">z0</span><span class="p">)))</span>

    <span class="c1"># (3) Method used when B**2 - 4*A*C is a square, is described in p. 6 of the below paper</span>
    <span class="c1"># by John P. Robertson, https://web.archive.org/web/20180831180321/http://www.jpr2718.org/ax2p.pdf</span>

    <span class="k">elif</span> <span class="n">is_square</span><span class="p">(</span><span class="n">discr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">A</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">discr</span><span class="p">)</span>
            <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;u, v&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">eq</span> <span class="o">=</span> <span class="n">_mexpand</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">u</span><span class="o">*</span><span class="n">v</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">D</span><span class="o">*</span><span class="p">(</span><span class="n">B</span><span class="o">*</span><span class="n">v</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">v</span> <span class="o">-</span> <span class="n">B</span><span class="o">*</span><span class="n">u</span><span class="p">)</span> <span class="o">+</span>
                          <span class="mi">2</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">F</span><span class="p">)</span>

            <span class="n">solution</span> <span class="o">=</span> <span class="n">diop_solve</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">s0</span><span class="p">,</span> <span class="n">t0</span> <span class="ow">in</span> <span class="n">solution</span><span class="p">:</span>

                <span class="n">num</span> <span class="o">=</span> <span class="n">B</span><span class="o">*</span><span class="n">t0</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">s0</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">t0</span> <span class="o">-</span> <span class="n">B</span><span class="o">*</span><span class="n">s0</span>
                <span class="n">x_0</span> <span class="o">=</span> <span class="n">num</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>
                <span class="n">y_0</span> <span class="o">=</span> <span class="p">(</span><span class="n">s0</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">((</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">))</span> <span class="ow">and</span>
                        <span class="n">check_param</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
                    <span class="n">ans</span> <span class="o">=</span> <span class="n">check_param</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                    <span class="n">sol</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">ans</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ans</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">elif</span> <span class="n">x_0</span><span class="o">.</span><span class="n">is_Integer</span> <span class="ow">and</span> <span class="n">y_0</span><span class="o">.</span><span class="n">is_Integer</span> <span class="ow">and</span> <span class="n">is_solution_quad</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">):</span>
                    <span class="n">sol</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">_diop_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>  <span class="c1"># Interchange x and y</span>
            <span class="k">while</span> <span class="n">s</span><span class="p">:</span>
                <span class="n">sol</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">pop</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># and solution &lt;--</span>

    <span class="c1"># (4) B**2 - 4*A*C &gt; 0 and B**2 - 4*A*C not a square or B**2 - 4*A*C &lt; 0</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">P</span><span class="p">,</span> <span class="n">Q</span> <span class="o">=</span> <span class="n">_transformation_to_DN</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
        <span class="n">D</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">_find_DN</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
        <span class="n">solns_pell</span> <span class="o">=</span> <span class="n">diop_DN</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">D</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="ow">in</span> <span class="n">solns_pell</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0</span><span class="p">]:</span>
                        <span class="n">s</span> <span class="o">=</span> <span class="n">P</span><span class="o">*</span><span class="n">Matrix</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span> <span class="o">+</span> <span class="n">Q</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">sol</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">as_int</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">s</span><span class="p">))</span>
                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># In this case equation can be transformed into a Pell equation</span>

            <span class="n">solns_pell</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">solns_pell</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">solns_pell</span><span class="p">):</span>
                <span class="n">solns_pell</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="o">-</span><span class="n">X</span><span class="p">,</span> <span class="o">-</span><span class="n">Y</span><span class="p">))</span>

            <span class="n">a</span> <span class="o">=</span> <span class="n">diop_DN</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">_is_int</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">P</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">Q</span><span class="p">[:</span><span class="mi">2</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">solns_pell</span><span class="p">:</span>
                    <span class="n">_a</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="n">s</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">U</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">**</span><span class="n">t</span>
                    <span class="n">_b</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">s</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">U</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">**</span><span class="n">t</span>
                    <span class="n">x_n</span> <span class="o">=</span> <span class="n">_mexpand</span><span class="p">((</span><span class="n">_a</span> <span class="o">+</span> <span class="n">_b</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">y_n</span> <span class="o">=</span> <span class="n">_mexpand</span><span class="p">((</span><span class="n">_a</span> <span class="o">-</span> <span class="n">_b</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)))</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">P</span><span class="o">*</span><span class="n">Matrix</span><span class="p">([</span><span class="n">x_n</span><span class="p">,</span> <span class="n">y_n</span><span class="p">])</span> <span class="o">+</span> <span class="n">Q</span>
                    <span class="n">sol</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">L</span> <span class="o">=</span> <span class="n">ilcm</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">denominator</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">P</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">Q</span><span class="p">[:</span><span class="mi">2</span><span class="p">]])</span>

                <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="n">T_k</span> <span class="o">=</span> <span class="n">T</span>
                <span class="n">U_k</span> <span class="o">=</span> <span class="n">U</span>

                <span class="k">while</span> <span class="p">(</span><span class="n">T_k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">L</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">U_k</span> <span class="o">%</span> <span class="n">L</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">T_k</span><span class="p">,</span> <span class="n">U_k</span> <span class="o">=</span> <span class="n">T_k</span><span class="o">*</span><span class="n">T</span> <span class="o">+</span> <span class="n">D</span><span class="o">*</span><span class="n">U_k</span><span class="o">*</span><span class="n">U</span><span class="p">,</span> <span class="n">T_k</span><span class="o">*</span><span class="n">U</span> <span class="o">+</span> <span class="n">U_k</span><span class="o">*</span><span class="n">T</span>
                    <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">for</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="ow">in</span> <span class="n">solns_pell</span><span class="p">:</span>

                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">_is_int</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">P</span><span class="o">*</span><span class="n">Matrix</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">])</span> <span class="o">+</span> <span class="n">Q</span><span class="p">):</span>
                            <span class="n">_a</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">Y</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">T_k</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">U_k</span><span class="p">)</span><span class="o">**</span><span class="n">t</span>
                            <span class="n">_b</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">Y</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">T_k</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">U_k</span><span class="p">)</span><span class="o">**</span><span class="n">t</span>
                            <span class="n">Xt</span> <span class="o">=</span> <span class="p">(</span><span class="n">_a</span> <span class="o">+</span> <span class="n">_b</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                            <span class="n">Yt</span> <span class="o">=</span> <span class="p">(</span><span class="n">_a</span> <span class="o">-</span> <span class="n">_b</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">))</span>
                            <span class="n">s</span> <span class="o">=</span> <span class="n">P</span><span class="o">*</span><span class="n">Matrix</span><span class="p">([</span><span class="n">Xt</span><span class="p">,</span> <span class="n">Yt</span><span class="p">])</span> <span class="o">+</span> <span class="n">Q</span>
                            <span class="n">sol</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

                        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">X</span><span class="o">*</span><span class="n">T</span> <span class="o">+</span> <span class="n">D</span><span class="o">*</span><span class="n">U</span><span class="o">*</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="o">*</span><span class="n">U</span> <span class="o">+</span> <span class="n">Y</span><span class="o">*</span><span class="n">T</span>

    <span class="k">return</span> <span class="n">sol</span>


<span class="k">def</span> <span class="nf">is_solution_quad</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check whether `(u, v)` is solution to the quadratic binary diophantine</span>
<span class="sd">    equation with the variable list ``var`` and coefficient dictionary</span>
<span class="sd">    ``coeff``.</span>

<span class="sd">    Not intended for use by normal users.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reps</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)))</span>
    <span class="n">eq</span> <span class="o">=</span> <span class="n">Add</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">j</span><span class="o">*</span><span class="n">i</span><span class="o">.</span><span class="n">xreplace</span><span class="p">(</span><span class="n">reps</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coeff</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
    <span class="k">return</span> <span class="n">_mexpand</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>


<div class="viewcode-block" id="diop_DN"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.diop_DN">[docs]</a><span class="k">def</span> <span class="nf">diop_DN</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves the equation `x^2 - Dy^2 = N`.</span>

<span class="sd">    Mainly concerned with the case `D &gt; 0, D` is not a perfect square,</span>
<span class="sd">    which is the same as the generalized Pell equation. The LMM</span>
<span class="sd">    algorithm is used to solve this equation.</span>

<span class="sd">    Returns</span>
<span class="sd">    =======</span>

<span class="sd">    A tuple of pairs, (`x, y)`, for each class of the solutions.</span>
<span class="sd">    Other solutions of the class can be constructed according to the</span>
<span class="sd">    values of ``D`` and ``N``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    D, N : Integer</span>
<span class="sd">        correspond to D and N in the equation.</span>
<span class="sd">    t : Symbol, optional</span>
<span class="sd">        is the parameter to be used in the solutions.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; diop_DN(13, -4)  # Solves equation x**2 - 13*y**2 = -4</span>
<span class="sd">    [(3, 1), (393, 109), (36, 10)]</span>

<span class="sd">    The output can be interpreted as follows: There are three fundamental</span>
<span class="sd">    solutions to the equation `x^2 - 13y^2 = -4` given by (3, 1), (393, 109)</span>
<span class="sd">    and (36, 10). Each tuple is in the form (x, y), i.e. solution (3, 1) means</span>
<span class="sd">    that `x = 3` and `y = 1`.</span>

<span class="sd">    &gt;&gt;&gt; diop_DN(986, 1)  # Solves equation x**2 - 986*y**2 = 1</span>
<span class="sd">    [(49299, 1570)]</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.solvers.diophantine.find_DN</span>
<span class="sd">    diofant.solvers.diophantine.diop_bf_DN</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    * Solving the generalized Pell equation x**2 - D*y**2 = N, John P.</span>
<span class="sd">      Robertson, July 31, 2004, Pages 16 - 17. [online], Available:</span>
<span class="sd">      https://web.archive.org/web/20180831180333/http://www.jpr2718.org/pell.pdf</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">D</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">N</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># N &gt; 0</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">divisors</span><span class="p">(</span><span class="n">square_factor</span><span class="p">(</span><span class="n">N</span><span class="p">)):</span>
                <span class="n">sols</span> <span class="o">=</span> <span class="n">cornacchia</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">D</span><span class="p">,</span> <span class="n">N</span> <span class="o">//</span> <span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sols</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">sols</span><span class="p">:</span>
                        <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">d</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="o">*</span><span class="n">y</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">D</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">d</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">d</span><span class="o">*</span><span class="n">x</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">sol</span>

    <span class="k">elif</span> <span class="n">D</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">)]</span>
        <span class="n">sN</span><span class="p">,</span> <span class="n">_exact</span> <span class="o">=</span> <span class="n">integer_nthroot</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_exact</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">sN</span><span class="p">,</span> <span class="n">t</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># D &gt; 0</span>
        <span class="n">sD</span><span class="p">,</span> <span class="n">_exact</span> <span class="o">=</span> <span class="n">integer_nthroot</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_exact</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[(</span><span class="n">sD</span><span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sol</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">sign</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sD</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">sq</span><span class="p">,</span> <span class="n">_exact</span> <span class="o">=</span> <span class="n">integer_nthroot</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">N</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">_exact</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="n">_exact</span><span class="p">:</span>
                        <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">sq</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

                <span class="k">return</span> <span class="n">sol</span>
        <span class="k">elif</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">N</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">D</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_special_diop_DN</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>

            <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

                <span class="n">pqa</span> <span class="o">=</span> <span class="n">PQa</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">G</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">B</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pqa</span><span class="p">:</span>  <span class="c1"># pragma: no branch</span>

                    <span class="n">a</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                    <span class="n">B</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>

                    <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">2</span><span class="o">*</span><span class="n">sD</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">_odd</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>

                    <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">count</span> <span class="o">=</span> <span class="n">j</span>
                        <span class="k">while</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">*</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">i</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">pqa</span><span class="p">)</span>
                            <span class="n">G</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">B</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

                        <span class="n">x</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">count</span><span class="p">]</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">count</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="p">[]</span>

                <span class="k">return</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">fs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">sol</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">div</span> <span class="o">=</span> <span class="n">divisors</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">div</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">divisible</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">):</span>
                        <span class="n">fs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fs</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">N</span> <span class="o">//</span> <span class="n">f</span><span class="o">**</span><span class="mi">2</span>

                    <span class="n">zs</span> <span class="o">=</span> <span class="n">sqrt_mod</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">all_roots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">zs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">zs</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span>

                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">zs</span> <span class="o">=</span> <span class="n">zs</span> <span class="o">+</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">zs</span> <span class="k">if</span> <span class="n">i</span><span class="p">]</span>  <span class="c1"># Omit duplicate zero</span>

                    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">zs</span><span class="p">:</span>

                        <span class="n">pqa</span> <span class="o">=</span> <span class="n">PQa</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">D</span><span class="p">)</span>
                        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">G</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">B</span> <span class="o">=</span> <span class="p">[]</span>

                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pqa</span><span class="p">:</span>  <span class="c1"># pragma: no branch</span>

                            <span class="n">a</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                            <span class="n">G</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">B</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>

                            <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">r</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                                <span class="n">s</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

                                <span class="k">if</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">D</span><span class="o">*</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span> <span class="o">==</span> <span class="n">m</span><span class="p">:</span>
                                    <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">f</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">f</span><span class="o">*</span><span class="n">s</span><span class="p">))</span>

                                <span class="k">elif</span> <span class="n">diop_DN</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="p">[]:</span>
                                    <span class="n">a</span> <span class="o">=</span> <span class="n">diop_DN</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                                    <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="o">*</span><span class="n">D</span><span class="p">),</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])))</span>

                                <span class="k">break</span>

                            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">length</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">D</span><span class="p">):</span>
                                <span class="k">break</span>

                <span class="k">return</span> <span class="n">sol</span></div>


<span class="k">def</span> <span class="nf">_special_diop_DN</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves the equation `x^2 - Dy^2 = N` for the special case where</span>
<span class="sd">    `1 &lt; N**2 &lt; D` and `D` is not a perfect square.</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    * :cite:`Andreescu15`, Section 4.4.4.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">N</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">D</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">integer_nthroot</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">sqrt_D</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
    <span class="n">F</span> <span class="o">=</span> <span class="p">[(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">f</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">f2</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="k">break</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">f2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
        <span class="n">f</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">P</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">G0</span><span class="p">,</span> <span class="n">G1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="n">B0</span><span class="p">,</span> <span class="n">B1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>

    <span class="n">solutions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">floor</span><span class="p">((</span><span class="n">P</span> <span class="o">+</span> <span class="n">sqrt_D</span><span class="p">)</span> <span class="o">/</span> <span class="n">Q</span><span class="p">)</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">Q</span> <span class="o">-</span> <span class="n">P</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="p">(</span><span class="n">D</span> <span class="o">-</span> <span class="n">P</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="n">Q</span>
        <span class="n">G2</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">G1</span> <span class="o">+</span> <span class="n">G0</span>
        <span class="n">B2</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">B1</span> <span class="o">+</span> <span class="n">B0</span>

        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">F</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">G2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">D</span><span class="o">*</span><span class="n">B2</span><span class="o">**</span><span class="mi">2</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
                <span class="n">solutions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">f</span><span class="o">*</span><span class="n">G2</span><span class="p">,</span> <span class="n">f</span><span class="o">*</span><span class="n">B2</span><span class="p">))</span>

        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">Q</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">G0</span><span class="p">,</span> <span class="n">G1</span> <span class="o">=</span> <span class="n">G1</span><span class="p">,</span> <span class="n">G2</span>
        <span class="n">B0</span><span class="p">,</span> <span class="n">B1</span> <span class="o">=</span> <span class="n">B1</span><span class="p">,</span> <span class="n">B2</span>

    <span class="k">return</span> <span class="n">solutions</span>


<div class="viewcode-block" id="cornacchia"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.cornacchia">[docs]</a><span class="k">def</span> <span class="nf">cornacchia</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves `ax^2 + by^2 = m` where `\gcd(a, b) = 1 = gcd(a, m)` and `a, b &gt; 0`.</span>

<span class="sd">    Uses the algorithm due to Cornacchia. The method only finds primitive</span>
<span class="sd">    solutions, i.e. ones with `\gcd(x, y) = 1`. So this method can&#39;t be used to</span>
<span class="sd">    find the solutions of `x^2 + y^2 = 20` since the only solution to former is</span>
<span class="sd">    `(x, y) = (4, 2)` and it is not primitive. When `a = b`, only the</span>
<span class="sd">    solutions with `x \leq y` are found. For more details, see the References.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; cornacchia(2, 3, 35)</span>
<span class="sd">    {(2, 3), (4, 1)}</span>
<span class="sd">    &gt;&gt;&gt; cornacchia(1, 1, 25)</span>
<span class="sd">    {(4, 3)}</span>

<span class="sd">    References</span>
<span class="sd">    ===========</span>

<span class="sd">    * A. Nitaj, &quot;L&#39;algorithme de Cornacchia&quot;</span>
<span class="sd">    * Solving the diophantine equation ax**2 + by**2 = m by Cornacchia&#39;s</span>
<span class="sd">      method, [online], Available:</span>
<span class="sd">      http://www.numbertheory.org/php/cornacchia.html</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.utilities.iterables.signed_permutations</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="n">a1</span> <span class="o">=</span> <span class="n">igcdex</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">m</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">sqrt_mod</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="o">*</span><span class="n">a1</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">all_roots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">m</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">u</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">m</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">u</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="p">,</span> <span class="n">u</span> <span class="o">%</span> <span class="n">r</span>
            <span class="k">if</span> <span class="n">a</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">m1</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span>

        <span class="k">if</span> <span class="n">m1</span> <span class="o">%</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">//</span> <span class="n">b</span>
            <span class="n">s</span><span class="p">,</span> <span class="n">_exact</span> <span class="o">=</span> <span class="n">integer_nthroot</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_exact</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span> <span class="ow">and</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">:</span>
                    <span class="n">r</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span> <span class="n">r</span>
                <span class="n">sols</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">sols</span></div>


<div class="viewcode-block" id="PQa"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.PQa">[docs]</a><span class="k">def</span> <span class="nf">PQa</span><span class="p">(</span><span class="n">P_0</span><span class="p">,</span> <span class="n">Q_0</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns useful information needed to solve the Pell equation.</span>

<span class="sd">    There are six sequences of integers defined related to the continued</span>
<span class="sd">    fraction representation of `\frac{P + \sqrt{D}}{Q}`, namely {`P_{i}`},</span>
<span class="sd">    {`Q_{i}`}, {`a_{i}`},{`A_{i}`}, {`B_{i}`}, {`G_{i}`}. ``PQa()`` Returns</span>
<span class="sd">    these values as a 6-tuple in the same order as mentioned above.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    P_0, Q_0, D : Integer</span>
<span class="sd">        integers corresponding to `P_{0}`, `Q_{0}` and `D` in the continued</span>
<span class="sd">        fraction `\frac{P_{0} + \sqrt{D}}{Q_{0}}`.  Also it&#39;s assumed</span>
<span class="sd">        that `P_{0}^2 == D mod(|Q_{0}|)` and `D` is square free.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; pqa = PQa(13, 4, 5)  # (13 + sqrt(5))/4</span>
<span class="sd">    &gt;&gt;&gt; next(pqa)  # (P_0, Q_0, a_0, A_0, B_0, G_0)</span>
<span class="sd">    (13, 4, 3, 3, 1, -1)</span>
<span class="sd">    &gt;&gt;&gt; next(pqa)  # (P_1, Q_1, a_1, A_1, B_1, G_1)</span>
<span class="sd">    (-1, 1, 1, 4, 1, 3)</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    * Solving the generalized Pell equation x^2 - Dy^2 = N, John P.</span>
<span class="sd">      Robertson, July 31, 2004, Pages 4 - 8. https://web.archive.org/web/20180831180333/http://www.jpr2718.org/pell.pdf</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A_i_2</span> <span class="o">=</span> <span class="n">B_i_1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">A_i_1</span> <span class="o">=</span> <span class="n">B_i_2</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">G_i_2</span> <span class="o">=</span> <span class="o">-</span><span class="n">P_0</span>
    <span class="n">G_i_1</span> <span class="o">=</span> <span class="n">Q_0</span>

    <span class="n">P_i</span> <span class="o">=</span> <span class="n">P_0</span>
    <span class="n">Q_i</span> <span class="o">=</span> <span class="n">Q_0</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>

        <span class="n">a_i</span> <span class="o">=</span> <span class="n">floor</span><span class="p">((</span><span class="n">P_i</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">/</span><span class="n">Q_i</span><span class="p">)</span>
        <span class="n">A_i</span> <span class="o">=</span> <span class="n">a_i</span><span class="o">*</span><span class="n">A_i_1</span> <span class="o">+</span> <span class="n">A_i_2</span>
        <span class="n">B_i</span> <span class="o">=</span> <span class="n">a_i</span><span class="o">*</span><span class="n">B_i_1</span> <span class="o">+</span> <span class="n">B_i_2</span>
        <span class="n">G_i</span> <span class="o">=</span> <span class="n">a_i</span><span class="o">*</span><span class="n">G_i_1</span> <span class="o">+</span> <span class="n">G_i_2</span>

        <span class="k">yield</span> <span class="n">P_i</span><span class="p">,</span> <span class="n">Q_i</span><span class="p">,</span> <span class="n">a_i</span><span class="p">,</span> <span class="n">A_i</span><span class="p">,</span> <span class="n">B_i</span><span class="p">,</span> <span class="n">G_i</span>

        <span class="n">A_i_1</span><span class="p">,</span> <span class="n">A_i_2</span> <span class="o">=</span> <span class="n">A_i</span><span class="p">,</span> <span class="n">A_i_1</span>
        <span class="n">B_i_1</span><span class="p">,</span> <span class="n">B_i_2</span> <span class="o">=</span> <span class="n">B_i</span><span class="p">,</span> <span class="n">B_i_1</span>
        <span class="n">G_i_1</span><span class="p">,</span> <span class="n">G_i_2</span> <span class="o">=</span> <span class="n">G_i</span><span class="p">,</span> <span class="n">G_i_1</span>

        <span class="n">P_i</span> <span class="o">=</span> <span class="n">a_i</span><span class="o">*</span><span class="n">Q_i</span> <span class="o">-</span> <span class="n">P_i</span>
        <span class="n">Q_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">D</span> <span class="o">-</span> <span class="n">P_i</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">Q_i</span></div>


<div class="viewcode-block" id="diop_bf_DN"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.diop_bf_DN">[docs]</a><span class="k">def</span> <span class="nf">diop_bf_DN</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses brute force to solve the equation, `x^2 - Dy^2 = N`.</span>

<span class="sd">    Mainly concerned with the generalized Pell equation which is the case when</span>
<span class="sd">    `D &gt; 0, D` is not a perfect square.</span>
<span class="sd">    Let `(t, u)` be the minimal positive solution of the equation</span>
<span class="sd">    `x^2 - Dy^2 = 1`. Then this method requires</span>
<span class="sd">    `\sqrt{\frac{\mid N \mid (t \pm 1)}{2D}}` to be small.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    D, N : Integer</span>
<span class="sd">        correspond to D and N in the equation.</span>
<span class="sd">    t : Symbol, optional</span>
<span class="sd">        is the parameter to be used in the solutions.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; diop_bf_DN(13, -4)</span>
<span class="sd">    [(3, 1), (-3, 1), (36, 10)]</span>
<span class="sd">    &gt;&gt;&gt; diop_bf_DN(986, 1)</span>
<span class="sd">    [(49299, 1570)]</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.solvers.diophantine.diop_DN</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    * Solving the generalized Pell equation x**2 - D*y**2 = N, John P.</span>
<span class="sd">      Robertson, July 31, 2004, Page 15. https://web.archive.org/web/20180831180333/http://www.jpr2718.org/pell.pdf</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">as_int</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">as_int</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

    <span class="n">sol</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">diop_DN</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">diop_DN</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">N</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">L1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">L2</span> <span class="o">=</span> <span class="n">integer_nthroot</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">D</span><span class="p">)),</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">elif</span> <span class="n">N</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">L1</span><span class="p">,</span> <span class="n">_exact</span> <span class="o">=</span> <span class="n">integer_nthroot</span><span class="p">(</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="n">D</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_exact</span><span class="p">:</span>
            <span class="n">L1</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">L2</span> <span class="o">=</span> <span class="n">integer_nthroot</span><span class="p">(</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="p">(</span><span class="n">u</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">D</span><span class="p">)),</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># N = 0</span>
        <span class="k">if</span> <span class="n">D</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">D</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sD</span><span class="p">,</span> <span class="n">_exact</span> <span class="o">=</span> <span class="n">integer_nthroot</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_exact</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[(</span><span class="n">sD</span><span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">sD</span><span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">_exact</span> <span class="o">=</span> <span class="n">integer_nthroot</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="n">D</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">_exact</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">_exact</span><span class="p">:</span>
            <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">equivalent</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
                <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">sol</span></div>


<div class="viewcode-block" id="equivalent"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.equivalent">[docs]</a><span class="k">def</span> <span class="nf">equivalent</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns True if two solutions `(u, v)` and `(r, s)` of `x^2 - Dy^2 = N`</span>
<span class="sd">    belongs to the same equivalence class and False otherwise.</span>

<span class="sd">    Two solutions `(u, v)` and `(r, s)` to the above equation fall to the same</span>
<span class="sd">    equivalence class iff both `(ur - Dvs)` and `(us - vr)` are divisible by</span>
<span class="sd">    `N`. No test is performed to test whether `(u, v)` and</span>
<span class="sd">    `(r, s)` are actually solutions to the equation. User should take care of</span>
<span class="sd">    this.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    u, v, r, s, D, N : Integer</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; equivalent(18, 5, -18, -5, 13, -1)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; equivalent(3, 1, -18, 393, 109, -4)</span>
<span class="sd">    False</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    * Solving the generalized Pell equation x**2 - D*y**2 = N, John P.</span>
<span class="sd">      Robertson, July 31, 2004, Page 12. https://web.archive.org/web/20180831180333/http://www.jpr2718.org/pell.pdf</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">divisible</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">r</span> <span class="o">-</span> <span class="n">D</span><span class="o">*</span><span class="n">v</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="ow">and</span> <span class="n">divisible</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">s</span> <span class="o">-</span> <span class="n">v</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">length</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the (length of aperiodic part + length of periodic part) of</span>
<span class="sd">    continued fraction representation of `\frac{P + \sqrt{D}}{Q}`.</span>

<span class="sd">    It is important to remember that this does NOT return the length of the</span>
<span class="sd">    periodic part but the sum of the lengths of the two parts as mentioned</span>
<span class="sd">    above.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    P, D, Q : Integer</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; length(-2, 4, 5)  # (-2 + sqrt(5))/4</span>
<span class="sd">    3</span>
<span class="sd">    &gt;&gt;&gt; length(-5, 4, 17)  # (-5 + sqrt(17))/4</span>
<span class="sd">    5</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.ntheory.continued_fraction.continued_fraction_periodic</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">..ntheory</span> <span class="k">import</span> <span class="n">continued_fraction_periodic</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">continued_fraction_periodic</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">rpt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">nonrpt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rpt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">nonrpt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rpt</span> <span class="o">+</span> <span class="n">nonrpt</span>


<div class="viewcode-block" id="transformation_to_DN"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.transformation_to_DN">[docs]</a><span class="k">def</span> <span class="nf">transformation_to_DN</span><span class="p">(</span><span class="n">eq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function transforms general quadratic,</span>
<span class="sd">    `ax^2 + bxy + cy^2 + dx + ey + f = 0`</span>
<span class="sd">    to more easy to deal with `X^2 - DY^2 = N` form.</span>

<span class="sd">    This is used to solve the general quadratic equation by transforming it to</span>
<span class="sd">    the latter form.  This function returns a tuple (A, B) where A is a 2 X 2</span>
<span class="sd">    matrix and B is a 2 X 1 matrix such that,</span>

<span class="sd">    Transpose([x y]) =  A * Transpose([X Y]) + B</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    eq : Expr</span>
<span class="sd">        the quadratic expression to be transformed.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; A, B = transformation_to_DN(x**2 - 3*x*y - y**2 - 2*y + 1)</span>
<span class="sd">    &gt;&gt;&gt; A</span>
<span class="sd">    Matrix([</span>
<span class="sd">    [1/26, 3/26],</span>
<span class="sd">    [   0, 1/13]])</span>
<span class="sd">    &gt;&gt;&gt; B</span>
<span class="sd">    Matrix([</span>
<span class="sd">    [-6/13],</span>
<span class="sd">    [-4/13]])</span>

<span class="sd">    A, B  returned are such that Transpose((x y)) =  A * Transpose((X Y)) + B.</span>
<span class="sd">    Substituting these values for `x` and `y` and a bit of simplifying work</span>
<span class="sd">    will give an equation of the form `x^2 - Dy^2 = N`.</span>

<span class="sd">    &gt;&gt;&gt; from diofant.abc import X, Y</span>
<span class="sd">    &gt;&gt;&gt; u = (A*Matrix([X, Y]) + B)[0]  # Transformation for x</span>
<span class="sd">    &gt;&gt;&gt; u</span>
<span class="sd">    X/26 + 3*Y/26 - 6/13</span>
<span class="sd">    &gt;&gt;&gt; v = (A*Matrix([X, Y]) + B)[1]  # Transformation for y</span>
<span class="sd">    &gt;&gt;&gt; v</span>
<span class="sd">    Y/13 - 4/13</span>

<span class="sd">    Next we will substitute these formulas for `x` and `y` and do</span>
<span class="sd">    ``simplify()``.</span>

<span class="sd">    &gt;&gt;&gt; eq = simplify((x**2 - 3*x*y - y**2 - 2*y + 1).subs({x: u, y: v}))</span>
<span class="sd">    &gt;&gt;&gt; eq</span>
<span class="sd">    X**2/676 - Y**2/52 + 17/13</span>

<span class="sd">    By multiplying the denominator appropriately, we can get a Pell equation</span>
<span class="sd">    in the standard form.</span>

<span class="sd">    &gt;&gt;&gt; eq * 676</span>
<span class="sd">    X**2 - 13*Y**2 + 884</span>

<span class="sd">    If only the final equation is needed, ``find_DN()`` can be used.</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.solvers.diophantine.find_DN</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    * Solving the equation ax^2 + bxy + cy^2 + dx + ey + f = 0,</span>
<span class="sd">      John P.Robertson, May 8, 2003, Page 7 - 11.</span>
<span class="sd">      https://web.archive.org/web/20180831180321/http://www.jpr2718.org/ax2p.pdf</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">diop_type</span> <span class="o">==</span> <span class="s2">&quot;binary_quadratic&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_transformation_to_DN</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_transformation_to_DN</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">var</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="n">as_int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">_remove_gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">)]</span>

    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;X, Y&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">b</span><span class="p">:</span>
        <span class="n">B</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">_rational_pq</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">_rational_pq</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">B</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># eq_1 = A*B*X**2 + B*(c*T - A*C**2)*Y**2 + d*T*X + (B*e*T - d*T*C)*Y + f*T*B</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="p">{</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span> <span class="n">A</span><span class="o">*</span><span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="o">*</span><span class="n">Y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span> <span class="n">B</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">T</span> <span class="o">-</span> <span class="n">A</span><span class="o">*</span><span class="n">C</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">X</span><span class="p">:</span> <span class="n">d</span><span class="o">*</span><span class="n">T</span><span class="p">,</span> <span class="n">Y</span><span class="p">:</span> <span class="n">B</span><span class="o">*</span><span class="n">e</span><span class="o">*</span><span class="n">T</span> <span class="o">-</span> <span class="n">d</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">C</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">f</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">B</span><span class="p">}</span>
        <span class="n">A_0</span><span class="p">,</span> <span class="n">B_0</span> <span class="o">=</span> <span class="n">_transformation_to_DN</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">],</span> <span class="n">coeff</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> <span class="o">-</span><span class="n">C</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">A_0</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> <span class="o">-</span><span class="n">C</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">B_0</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">B</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">_rational_pq</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
            <span class="n">A</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">_rational_pq</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">B</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

            <span class="c1"># eq_2 = A*X**2 + c*T*Y**2 + e*T*Y + f*T - A*C**2</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="p">{</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="o">*</span><span class="n">Y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span> <span class="n">c</span><span class="o">*</span><span class="n">T</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Y</span><span class="p">:</span> <span class="n">e</span><span class="o">*</span><span class="n">T</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">f</span><span class="o">*</span><span class="n">T</span> <span class="o">-</span> <span class="n">A</span><span class="o">*</span><span class="n">C</span><span class="o">**</span><span class="mi">2</span><span class="p">}</span>
            <span class="n">A_0</span><span class="p">,</span> <span class="n">B_0</span> <span class="o">=</span> <span class="n">_transformation_to_DN</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">],</span> <span class="n">coeff</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">A_0</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">B_0</span> <span class="o">+</span> <span class="n">Matrix</span><span class="p">([</span><span class="o">-</span><span class="n">C</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">B</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">_rational_pq</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="n">A</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">_rational_pq</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">B</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

                <span class="c1"># eq_3 = a*T*X**2 + A*Y**2 + f*T - A*C**2</span>
                <span class="n">coeff</span> <span class="o">=</span> <span class="p">{</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span> <span class="n">a</span><span class="o">*</span><span class="n">T</span><span class="p">,</span> <span class="n">X</span><span class="o">*</span><span class="n">Y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">f</span><span class="o">*</span><span class="n">T</span> <span class="o">-</span> <span class="n">A</span><span class="o">*</span><span class="n">C</span><span class="o">**</span><span class="mi">2</span><span class="p">}</span>
                <span class="n">A_0</span><span class="p">,</span> <span class="n">B_0</span> <span class="o">=</span> <span class="n">_transformation_to_DN</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">],</span> <span class="n">coeff</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="p">])</span><span class="o">*</span><span class="n">A_0</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="p">])</span><span class="o">*</span><span class="n">B_0</span> <span class="o">+</span> <span class="n">Matrix</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">C</span><span class="o">/</span><span class="n">B</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># TODO: pre-simplification: Not necessary but may simplify</span>
                <span class="c1"># the equation.</span>

                <span class="k">return</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">Matrix</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>


<div class="viewcode-block" id="find_DN"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.find_DN">[docs]</a><span class="k">def</span> <span class="nf">find_DN</span><span class="p">(</span><span class="n">eq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function returns a tuple, `(D, N)` of the simplified form,</span>
<span class="sd">    `x^2 - Dy^2 = N`, corresponding to the general quadratic,</span>
<span class="sd">    `ax^2 + bxy + cy^2 + dx + ey + f = 0`.</span>

<span class="sd">    Solving the general quadratic is then equivalent to solving the equation</span>
<span class="sd">    `X^2 - DY^2 = N` and transforming the solutions by using the transformation</span>
<span class="sd">    matrices returned by ``transformation_to_DN()``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    eq : Expr</span>
<span class="sd">        is the quadratic expression to be transformed.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; find_DN(x**2 - 3*x*y - y**2 - 2*y + 1)</span>
<span class="sd">    (13, -884)</span>

<span class="sd">    Interpretation of the output is that we get `X^2 -13Y^2 = -884` after</span>
<span class="sd">    transforming `x^2 - 3xy - y^2 - 2y + 1` using the transformation returned</span>
<span class="sd">    by ``transformation_to_DN()``.</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.solvers.diophantine.transformation_to_DN</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    * Solving the equation ax^2 + bxy + cy^2 + dx + ey + f = 0,</span>
<span class="sd">      John P.Robertson, May 8, 2003, Page 7 - 11.</span>
<span class="sd">      https://web.archive.org/web/20180831180321/http://www.jpr2718.org/ax2p.pdf</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">diop_type</span> <span class="o">==</span> <span class="s2">&quot;binary_quadratic&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_find_DN</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_find_DN</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">var</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;X, Y&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">_transformation_to_DN</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

    <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">Matrix</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">])</span> <span class="o">+</span> <span class="n">B</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">Matrix</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">])</span> <span class="o">+</span> <span class="n">B</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">eq</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">+</span> <span class="n">coeff</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">simplified</span> <span class="o">=</span> <span class="n">_mexpand</span><span class="p">(</span><span class="n">eq</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">x</span><span class="p">:</span> <span class="n">u</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">v</span><span class="p">}))</span>

    <span class="n">coeff</span> <span class="o">=</span> <span class="n">simplified</span><span class="o">.</span><span class="n">as_coefficients_dict</span><span class="p">()</span>

    <span class="k">return</span> <span class="o">-</span><span class="n">coeff</span><span class="p">[</span><span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">coeff</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="n">coeff</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">coeff</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">check_param</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If there is a number modulo ``a`` such that ``x`` and ``y`` are both</span>
<span class="sd">    integers, then return a parametric representation for ``x`` and ``y``</span>
<span class="sd">    else return (None, None).</span>

<span class="sd">    Here ``x`` and ``y`` are functions of ``t``.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">..simplify.simplify</span> <span class="k">import</span> <span class="n">clear_coefficients</span>

    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_number</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">is_Integer</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">is_number</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">y</span><span class="o">.</span><span class="n">is_Integer</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;m, n&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">n</span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">as_content_primitive</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">%</span> <span class="n">c</span><span class="o">.</span><span class="n">denominator</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="c1"># clear_coefficients(mx + b, R)[1] -&gt; (R - b)/m</span>
    <span class="n">eq</span> <span class="o">=</span> <span class="n">clear_coefficients</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">m</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">clear_coefficients</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">junk</span><span class="p">,</span> <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">as_content_primitive</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">diop_solve</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>


<div class="viewcode-block" id="diop_ternary_quadratic"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.diop_ternary_quadratic">[docs]</a><span class="k">def</span> <span class="nf">diop_ternary_quadratic</span><span class="p">(</span><span class="n">eq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves the general quadratic ternary form,</span>
<span class="sd">    `ax^2 + by^2 + cz^2 + fxy + gyz + hxz = 0`.</span>

<span class="sd">    Returns</span>
<span class="sd">    =======</span>

<span class="sd">    tuple</span>
<span class="sd">       which is a base solution for the above equation. If there are no</span>
<span class="sd">       solutions, ``(None, None, None)`` is returned.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ===========</span>

<span class="sd">    eq : Expr</span>
<span class="sd">        should be an homogeneous expression of degree two in three variables</span>
<span class="sd">        and it is assumed to be zero.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; diop_ternary_quadratic(x**2 + 3*y**2 - z**2)</span>
<span class="sd">    (1, 0, 1)</span>
<span class="sd">    &gt;&gt;&gt; diop_ternary_quadratic(4*x**2 + 5*y**2 - z**2)</span>
<span class="sd">    (1, 0, 2)</span>
<span class="sd">    &gt;&gt;&gt; diop_ternary_quadratic(45*x**2 - 7*y**2 - 8*x*y - z**2)</span>
<span class="sd">    (28, 45, 105)</span>
<span class="sd">    &gt;&gt;&gt; diop_ternary_quadratic(x**2 - 49*y**2 - z**2 + 13*z*y -8*x*y)</span>
<span class="sd">    (9, 1, 5)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">diop_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;homogeneous_ternary_quadratic&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;homogeneous_ternary_quadratic_normal&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_diop_ternary_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_diop_ternary_quadratic</span><span class="p">(</span><span class="n">_var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">_var</span>
    <span class="n">var</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span>

    <span class="c1"># Equations of the form B*x*y + C*z*x + E*y*z = 0 and At least two of the</span>
    <span class="c1"># coefficients A, B, C are non-zero.</span>
    <span class="c1"># There are infinitely many solutions for the equation.</span>
    <span class="c1"># Ex: (0, 0, t), (0, t, 0), (t, 0, 0)</span>
    <span class="c1"># Equation can be re-written as y*(B*x + E*z) = -C*x*z and we can find rather</span>
    <span class="c1"># unobviuos solutions. Set y = -C and B*x + E*z = x*z. The latter can be solved by</span>
    <span class="c1"># using methods for binary quadratic diophantine equations. Let&#39;s select the</span>
    <span class="c1"># solution which minimizes |x| + |z|</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">var</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">]:</span>
            <span class="n">sols</span> <span class="o">=</span> <span class="n">diophantine</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">]</span><span class="o">*</span><span class="n">z</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">sols</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">min_sum</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">sols</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">min_sum</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">r</span>
                    <span class="n">min_sum</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_var</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_0</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">_diop_ternary_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_remove_gcd</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># If the coefficient of x is zero change the variables</span>
        <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">_var</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">z_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">x_0</span> <span class="o">=</span> <span class="n">_diop_ternary_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_var</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_0</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">_diop_ternary_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span> <span class="ow">or</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">]:</span>
            <span class="c1"># Apply the transformation x --&gt; X - (B*y + C*z)/(2*A)</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">]</span>
            <span class="n">D</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">E</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">]</span>
            <span class="n">F</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>

            <span class="n">_coeff</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">_coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">_coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">D</span> <span class="o">-</span> <span class="n">B</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">_coeff</span><span class="p">[</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">F</span> <span class="o">-</span> <span class="n">C</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">_coeff</span><span class="p">[</span><span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">E</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">B</span><span class="o">*</span><span class="n">C</span>
            <span class="n">_coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">_coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">_diop_ternary_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">_coeff</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">x_0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

            <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">_rational_pq</span><span class="p">(</span><span class="n">B</span><span class="o">*</span><span class="n">y_0</span> <span class="o">+</span> <span class="n">C</span><span class="o">*</span><span class="n">z_0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">A</span><span class="p">)</span>
            <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">x_0</span><span class="o">*</span><span class="n">q</span> <span class="o">-</span> <span class="n">p</span><span class="p">,</span> <span class="n">y_0</span><span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="n">z_0</span><span class="o">*</span><span class="n">q</span>

        <span class="k">elif</span> <span class="n">coeff</span><span class="p">[</span><span class="n">z</span><span class="o">*</span><span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># Equations of the form A*x**2 + E*yz = 0.</span>
                    <span class="n">A</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">E</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">]</span>

                    <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">_rational_pq</span><span class="p">(</span><span class="o">-</span><span class="n">E</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>

                    <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Ax**2 + E*y*z + F*z**2  = 0</span>
                    <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">_var</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">z_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">x_0</span> <span class="o">=</span> <span class="n">_diop_ternary_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># A*x**2 + D*y**2 + E*y*z + F*z**2 = 0, C may be zero</span>
                <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_var</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y_0</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">_diop_ternary_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Ax**2 + D*y**2 + F*z**2 = 0, C may be zero</span>
            <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">_diop_ternary_quadratic_normal</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_remove_gcd</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">)</span>


<div class="viewcode-block" id="transformation_to_normal"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.transformation_to_normal">[docs]</a><span class="k">def</span> <span class="nf">transformation_to_normal</span><span class="p">(</span><span class="n">eq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the transformation Matrix that converts a general ternary</span>
<span class="sd">    quadratic equation `eq` (`ax^2 + by^2 + cz^2 + dxy + eyz + fxz`)</span>
<span class="sd">    to a form without cross terms: `ax^2 + by^2 + cz^2 = 0`. This is</span>
<span class="sd">    not used in solving ternary quadratics; it is only implemented for</span>
<span class="sd">    the sake of completeness.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">diop_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;homogeneous_ternary_quadratic&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;homogeneous_ternary_quadratic_normal&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_transformation_to_normal</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_transformation_to_normal</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>

    <span class="n">_var</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>  <span class="c1"># copy</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">var</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">var</span><span class="p">):</span>
        <span class="c1"># https://math.stackexchange.com/questions/448051/transform-quadratic-ternary-form-to-normal-form/448065#448065</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">]</span>
        <span class="n">swap</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="p">:</span>  <span class="c1"># b can&#39;t be 0 or else there aren&#39;t 3 vars</span>
            <span class="n">swap</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="o">/</span><span class="n">a</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="o">/</span><span class="n">a</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">swap</span><span class="p">:</span>
            <span class="n">T</span><span class="o">.</span><span class="n">row_swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">T</span><span class="o">.</span><span class="n">col_swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">T</span>

    <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># If the coefficient of x is zero change the variables</span>
        <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">_transformation_to_normal</span><span class="p">(</span><span class="n">_var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
            <span class="n">T</span><span class="o">.</span><span class="n">row_swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">T</span><span class="o">.</span><span class="n">col_swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">T</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">_transformation_to_normal</span><span class="p">(</span><span class="n">_var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
            <span class="n">T</span><span class="o">.</span><span class="n">row_swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">T</span><span class="o">.</span><span class="n">col_swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">T</span>

    <span class="c1"># Apply the transformation x --&gt; X - (B*Y + C*Z)/(2*A)</span>
    <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">]</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">]</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">_coeff</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">D</span> <span class="o">-</span> <span class="n">B</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">F</span> <span class="o">-</span> <span class="n">C</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                  <span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">:</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">E</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">B</span><span class="o">*</span><span class="n">C</span><span class="p">,</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

        <span class="n">T_0</span> <span class="o">=</span> <span class="n">_transformation_to_normal</span><span class="p">(</span><span class="n">_var</span><span class="p">,</span> <span class="n">_coeff</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">Integer</span><span class="p">(</span><span class="o">-</span><span class="n">B</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">A</span><span class="p">),</span> <span class="n">Integer</span><span class="p">(</span><span class="o">-</span><span class="n">C</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">A</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">T_0</span>

    <span class="k">elif</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Equations of the form A*x**2 + E*yz = 0.</span>
                <span class="c1"># Apply transformation y -&gt; Y + Z ans z -&gt; Y - Z</span>
                <span class="k">return</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Ax**2 + E*y*z + F*z**2  = 0</span>
                <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">T</span> <span class="o">=</span> <span class="n">_transformation_to_normal</span><span class="p">(</span><span class="n">_var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
                <span class="n">T</span><span class="o">.</span><span class="n">row_swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">T</span><span class="o">.</span><span class="n">col_swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">T</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># A*x**2 + D*y**2 + E*y*z + F*z**2 = 0, F may be zero</span>
            <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">_transformation_to_normal</span><span class="p">(</span><span class="n">_var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
            <span class="n">T</span><span class="o">.</span><span class="n">row_swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">T</span><span class="o">.</span><span class="n">col_swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">T</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Matrix</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>


<div class="viewcode-block" id="parametrize_ternary_quadratic"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.parametrize_ternary_quadratic">[docs]</a><span class="k">def</span> <span class="nf">parametrize_ternary_quadratic</span><span class="p">(</span><span class="n">eq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the parametrized general solution for the ternary quadratic</span>
<span class="sd">    equation ``eq`` which has the form</span>
<span class="sd">    `ax^2 + by^2 + cz^2 + fxy + gyz + hxz = 0`.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; parametrize_ternary_quadratic(x**2 + y**2 - z**2)</span>
<span class="sd">    (2*p*q, p**2 - q**2, p**2 + q**2)</span>

<span class="sd">    Here `p` and `q` are two co-prime integers.</span>

<span class="sd">    &gt;&gt;&gt; parametrize_ternary_quadratic(3*x**2 + 2*y**2 - z**2 - 2*x*y + 5*y*z - 7*y*z)</span>
<span class="sd">    (2*p**2 - 2*p*q - q**2, 2*p**2 + 2*p*q - q**2, 2*p**2 - 2*p*q + 3*q**2)</span>
<span class="sd">    &gt;&gt;&gt; parametrize_ternary_quadratic(124*x**2 - 30*y**2 - 7729*z**2)</span>
<span class="sd">    (-1410*p**2 - 363263*q**2, 2700*p**2 + 30916*p*q - 695610*q**2, -60*p**2 + 5400*p*q + 15458*q**2)</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    * The algorithmic resolution of Diophantine equations, Nigel P. Smart,</span>
<span class="sd">      London Mathematical Society Student Texts 41, Cambridge University</span>
<span class="sd">      Press, Cambridge, 1998.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">diop_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;homogeneous_ternary_quadratic&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;homogeneous_ternary_quadratic_normal&quot;</span><span class="p">):</span>
        <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">_diop_ternary_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_parametrize_ternary_quadratic</span><span class="p">((</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">),</span> <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_parametrize_ternary_quadratic</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">_var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>
    <span class="c1"># called for a*x**2 + b*y**2 + c*z**2 + d*x*y + e*y*z + f*x*z = 0</span>
    <span class="k">assert</span> <span class="mi">1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">coeff</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">_var</span>

    <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">solution</span>

    <span class="n">v</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_var</span><span class="p">)</span>  <span class="c1"># copy</span>

    <span class="k">if</span> <span class="n">x_0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">solution</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># if there are 2 zeros the the equation reduces</span>
        <span class="c1"># to k*X**2 == 0 where X is x, y, or z so X must</span>
        <span class="c1"># be zero, too. So there is only the trivial solution.</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">x_0</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y_p</span><span class="p">,</span> <span class="n">x_p</span><span class="p">,</span> <span class="n">z_p</span> <span class="o">=</span> <span class="n">_parametrize_ternary_quadratic</span><span class="p">((</span><span class="n">y_0</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">),</span> <span class="n">v</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x_p</span><span class="p">,</span> <span class="n">y_p</span><span class="p">,</span> <span class="n">z_p</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">v</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;r, p, q&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">eq</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">coeff</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">eq_1</span> <span class="o">=</span> <span class="n">_mexpand</span><span class="p">(</span><span class="n">eq</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">x</span><span class="p">:</span> <span class="n">r</span><span class="o">*</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">r</span><span class="o">*</span><span class="n">y_0</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">r</span><span class="o">*</span><span class="n">z_0</span> <span class="o">+</span> <span class="n">q</span><span class="p">}))</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">eq_1</span><span class="o">.</span><span class="n">as_independent</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">as_Add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">x_0</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">y_0</span> <span class="o">-</span> <span class="n">_mexpand</span><span class="p">(</span><span class="n">B</span><span class="o">/</span><span class="n">r</span><span class="o">*</span><span class="n">p</span><span class="p">))</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">z_0</span> <span class="o">-</span> <span class="n">_mexpand</span><span class="p">(</span><span class="n">B</span><span class="o">/</span><span class="n">r</span><span class="o">*</span><span class="n">q</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>


<div class="viewcode-block" id="diop_ternary_quadratic_normal"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.diop_ternary_quadratic_normal">[docs]</a><span class="k">def</span> <span class="nf">diop_ternary_quadratic_normal</span><span class="p">(</span><span class="n">eq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves the quadratic ternary diophantine equation,</span>
<span class="sd">    `ax^2 + by^2 + cz^2 = 0`.</span>

<span class="sd">    Here the coefficients `a`, `b`, and `c` should be non zero. Otherwise the</span>
<span class="sd">    equation will be a quadratic binary or univariate equation. If solvable,</span>
<span class="sd">    returns a tuple `(x, y, z)` that satisifes the given equation. If the</span>
<span class="sd">    equation does not have integer solutions, `(None, None, None)` is returned.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; diop_ternary_quadratic_normal(x**2 + 3*y**2 - z**2)</span>
<span class="sd">    (1, 0, 1)</span>
<span class="sd">    &gt;&gt;&gt; diop_ternary_quadratic_normal(4*x**2 + 5*y**2 - z**2)</span>
<span class="sd">    (1, 0, 2)</span>
<span class="sd">    &gt;&gt;&gt; diop_ternary_quadratic_normal(34*x**2 - 3*y**2 - 301*z**2)</span>
<span class="sd">    (4, 9, 1)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">diop_type</span> <span class="o">==</span> <span class="s2">&quot;homogeneous_ternary_quadratic_normal&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_diop_ternary_quadratic_normal</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_diop_ternary_quadratic_normal</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">var</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">coeff</span> <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span> <span class="o">==</span> <span class="mi">3</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">var</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">filldedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    coeff dict is not consistent with assumption of this routine:</span>
<span class="s1">    coefficients should be those of an expression in the form</span>
<span class="s1">    a*x**2 + b*y**2 + c*z**2 where a*b*c != 0.&#39;&#39;&#39;</span><span class="p">))</span>

    <span class="p">(</span><span class="n">sqf_of_a</span><span class="p">,</span> <span class="n">sqf_of_b</span><span class="p">,</span> <span class="n">sqf_of_c</span><span class="p">),</span> <span class="p">(</span><span class="n">a_1</span><span class="p">,</span> <span class="n">b_1</span><span class="p">,</span> <span class="n">c_1</span><span class="p">),</span> <span class="p">(</span><span class="n">a_2</span><span class="p">,</span> <span class="n">b_2</span><span class="p">,</span> <span class="n">c_2</span><span class="p">)</span> <span class="o">=</span> <span class="n">sqf_normal</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">A</span> <span class="o">=</span> <span class="o">-</span><span class="n">a_2</span><span class="o">*</span><span class="n">c_2</span>
    <span class="n">B</span> <span class="o">=</span> <span class="o">-</span><span class="n">b_2</span><span class="o">*</span><span class="n">c_2</span>

    <span class="c1"># If following two conditions are satisified then there are no solutions</span>
    <span class="k">if</span> <span class="n">A</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">B</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">_</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="p">[</span><span class="n">sqrt_mod</span><span class="p">(</span><span class="o">-</span><span class="n">b_2</span><span class="o">*</span><span class="n">c_2</span><span class="p">,</span> <span class="n">a_2</span><span class="p">),</span>
                               <span class="n">sqrt_mod</span><span class="p">(</span><span class="o">-</span><span class="n">c_2</span><span class="o">*</span><span class="n">a_2</span><span class="p">,</span> <span class="n">b_2</span><span class="p">),</span>
                               <span class="n">sqrt_mod</span><span class="p">(</span><span class="o">-</span><span class="n">a_2</span><span class="o">*</span><span class="n">b_2</span><span class="p">,</span> <span class="n">c_2</span><span class="p">)]):</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="n">z_0</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span> <span class="o">=</span> <span class="n">descent</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>

    <span class="n">z_0</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">_rational_pq</span><span class="p">(</span><span class="n">z_0</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">c_2</span><span class="p">))</span>
    <span class="n">x_0</span> <span class="o">*=</span> <span class="n">q</span>
    <span class="n">y_0</span> <span class="o">*=</span> <span class="n">q</span>

    <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">_remove_gcd</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">)</span>

    <span class="c1"># Holzer reduction</span>
    <span class="k">if</span> <span class="n">sign</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="n">sign</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">holzer</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a_2</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">b_2</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">c_2</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">sign</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="n">sign</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="n">x_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">,</span> <span class="n">y_0</span> <span class="o">=</span> <span class="n">holzer</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a_2</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">c_2</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">b_2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">,</span> <span class="n">x_0</span> <span class="o">=</span> <span class="n">holzer</span><span class="p">(</span><span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">b_2</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">c_2</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a_2</span><span class="p">))</span>

    <span class="n">x_0</span> <span class="o">=</span> <span class="n">reconstruct</span><span class="p">(</span><span class="n">b_1</span><span class="p">,</span> <span class="n">c_1</span><span class="p">,</span> <span class="n">x_0</span><span class="p">)</span>
    <span class="n">y_0</span> <span class="o">=</span> <span class="n">reconstruct</span><span class="p">(</span><span class="n">a_1</span><span class="p">,</span> <span class="n">c_1</span><span class="p">,</span> <span class="n">y_0</span><span class="p">)</span>
    <span class="n">z_0</span> <span class="o">=</span> <span class="n">reconstruct</span><span class="p">(</span><span class="n">a_1</span><span class="p">,</span> <span class="n">b_1</span><span class="p">,</span> <span class="n">z_0</span><span class="p">)</span>

    <span class="n">sq_lcm</span> <span class="o">=</span> <span class="n">ilcm</span><span class="p">(</span><span class="n">sqf_of_a</span><span class="p">,</span> <span class="n">sqf_of_b</span><span class="p">,</span> <span class="n">sqf_of_c</span><span class="p">)</span>

    <span class="n">x_0</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_0</span><span class="o">*</span><span class="n">sq_lcm</span><span class="o">//</span><span class="n">sqf_of_a</span><span class="p">)</span>
    <span class="n">y_0</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_0</span><span class="o">*</span><span class="n">sq_lcm</span><span class="o">//</span><span class="n">sqf_of_b</span><span class="p">)</span>
    <span class="n">z_0</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">z_0</span><span class="o">*</span><span class="n">sq_lcm</span><span class="o">//</span><span class="n">sqf_of_c</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_remove_gcd</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">)</span>


<div class="viewcode-block" id="sqf_normal"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.sqf_normal">[docs]</a><span class="k">def</span> <span class="nf">sqf_normal</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return `a&#39;, b&#39;, c&#39;`, the coefficients of the square-free normal</span>
<span class="sd">    form of `ax^2 + by^2 + cz^2 = 0`, where `a&#39;, b&#39;, c&#39;` are pairwise</span>
<span class="sd">    prime.  If `steps` is True then also return three tuples:</span>
<span class="sd">    `sq`, `sqf`, and `(a&#39;, b&#39;, c&#39;)` where `sq` contains the square</span>
<span class="sd">    factors of `a`, `b` and `c` after removing the `gcd(a, b, c)`;</span>
<span class="sd">    `sqf` contains the values of `a`, `b` and `c` after removing</span>
<span class="sd">    both the `gcd(a, b, c)` and the square factors.</span>

<span class="sd">    The solutions for `ax^2 + by^2 + cz^2 = 0` can be</span>
<span class="sd">    recovered from the solutions of `a&#39;x^2 + b&#39;y^2 + c&#39;z^2 = 0`.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; sqf_normal(2 * 3**2 * 5, 2 * 5 * 11, 2 * 7**2 * 11)</span>
<span class="sd">    (11, 1, 5)</span>
<span class="sd">    &gt;&gt;&gt; sqf_normal(2 * 3**2 * 5, 2 * 5 * 11, 2 * 7**2 * 11, True)</span>
<span class="sd">    ((3, 1, 7), (5, 55, 11), (11, 1, 5))</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    * Legendre&#39;s Theorem, Legrange&#39;s Descent,</span>
<span class="sd">      https://public.csusm.edu/aitken_html/notes/legendre.pdf</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.solvers.diophantine.reconstruct</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ABC</span> <span class="o">=</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">_remove_gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
    <span class="n">sq</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">square_factor</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ABC</span><span class="p">)</span>
    <span class="n">sqf</span> <span class="o">=</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">i</span><span class="o">//</span><span class="n">j</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ABC</span><span class="p">,</span> <span class="n">sq</span><span class="p">))</span>
    <span class="n">pc</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">//=</span> <span class="n">pc</span>
    <span class="n">B</span> <span class="o">//=</span> <span class="n">pc</span>
    <span class="n">pa</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">//=</span> <span class="n">pa</span>
    <span class="n">C</span> <span class="o">//=</span> <span class="n">pa</span>
    <span class="n">pb</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">//=</span> <span class="n">pb</span>
    <span class="n">B</span> <span class="o">//=</span> <span class="n">pb</span>

    <span class="n">A</span> <span class="o">*=</span> <span class="n">pa</span>
    <span class="n">B</span> <span class="o">*=</span> <span class="n">pb</span>
    <span class="n">C</span> <span class="o">*=</span> <span class="n">pc</span>

    <span class="k">if</span> <span class="n">steps</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sq</span><span class="p">,</span> <span class="n">sqf</span><span class="p">,</span> <span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span></div>


<div class="viewcode-block" id="square_factor"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.square_factor">[docs]</a><span class="k">def</span> <span class="nf">square_factor</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns an integer `c` s.t. `a = c^2k, \ c,k \in Z`. Here `k` is square</span>
<span class="sd">    free. `a` can be given as an integer or a dictionary of factors.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; square_factor(24)</span>
<span class="sd">    2</span>
<span class="sd">    &gt;&gt;&gt; square_factor(-36*3)</span>
<span class="sd">    6</span>
<span class="sd">    &gt;&gt;&gt; square_factor(1)</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; square_factor({3: 2, 2: 1, -1: 1})</span>
<span class="sd">    3</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.solvers.diophantine.reconstruct</span>
<span class="sd">    diofant.ntheory.factor_.core</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">a</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">factorint</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Mul</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">p</span><span class="o">**</span><span class="p">(</span><span class="n">e</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span></div>


<div class="viewcode-block" id="reconstruct"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.reconstruct">[docs]</a><span class="k">def</span> <span class="nf">reconstruct</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reconstruct the `z` value of an equivalent solution of `ax^2 + by^2 + cz^2`</span>
<span class="sd">    from the `z` value of a solution of the square-free normal form of the</span>
<span class="sd">    equation, `a&#39;*x^2 + b&#39;*y^2 + c&#39;*z^2`, where `a&#39;`, `b&#39;` and `c&#39;` are square</span>
<span class="sd">    free and `gcd(a&#39;, b&#39;, c&#39;) == 1`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">factorint</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;a and b should be square-free&#39;</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">*=</span> <span class="n">p</span>
    <span class="k">return</span> <span class="n">z</span></div>


<div class="viewcode-block" id="ldescent"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.ldescent">[docs]</a><span class="k">def</span> <span class="nf">ldescent</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a non-trivial solution to `w^2 = Ax^2 + By^2` using</span>
<span class="sd">    Lagrange&#39;s method; return None if there is no such solution.</span>

<span class="sd">    Here, `A \neq 0` and `B \neq 0` and `A` and `B` are square free. Output a</span>
<span class="sd">    tuple `(w_0, x_0, y_0)` which is a solution to the above equation.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; ldescent(1, 1)  # w^2 = x^2 + y^2</span>
<span class="sd">    (1, 1, 0)</span>
<span class="sd">    &gt;&gt;&gt; ldescent(4, -7)  # w^2 = 4x^2 - 7y^2</span>
<span class="sd">    (2, -1, 0)</span>

<span class="sd">    This means that `x = -1, y = 0` and `w = 2` is a solution to the equation</span>
<span class="sd">    `w^2 = 4x^2 - 7y^2`</span>

<span class="sd">    &gt;&gt;&gt; ldescent(5, -1)  # w^2 = 5x^2 - y^2</span>
<span class="sd">    (2, 1, -1)</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    * The algorithmic resolution of Diophantine equations, Nigel P. Smart,</span>
<span class="sd">      London Mathematical Society Student Texts 41, Cambridge University</span>
<span class="sd">      Press, Cambridge, 1998.</span>
<span class="sd">    * Efficient Solution of Rational Conices, J. E. Cremona and D. Rusin,</span>
<span class="sd">      Mathematics of Computation, Volume 00, Number 0,</span>
<span class="sd">      http://eprints.nottingham.ac.uk/60/1/kvxefz87.pdf</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">B</span><span class="p">):</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">ldescent</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

    <span class="k">if</span> <span class="n">A</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">B</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">B</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># and A == -1</span>
        <span class="k">return</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">sqrt_mod</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>

    <span class="n">Q</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">//</span> <span class="n">B</span>

    <span class="k">if</span> <span class="n">Q</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">B_0</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">div</span> <span class="o">=</span> <span class="n">divisors</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
        <span class="n">B_0</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">div</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="n">sQ</span><span class="p">,</span> <span class="n">_exact</span> <span class="o">=</span> <span class="n">integer_nthroot</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span> <span class="o">//</span> <span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_exact</span><span class="p">:</span>
                <span class="n">B_0</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">sQ</span>
                <span class="k">break</span>

    <span class="k">assert</span> <span class="n">B_0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="n">W</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">ldescent</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B_0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_remove_gcd</span><span class="p">((</span><span class="o">-</span><span class="n">A</span><span class="o">*</span><span class="n">X</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">W</span><span class="p">),</span> <span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">X</span> <span class="o">-</span> <span class="n">W</span><span class="p">),</span> <span class="n">Y</span><span class="o">*</span><span class="p">(</span><span class="n">B_0</span><span class="o">*</span><span class="n">d</span><span class="p">))</span></div>


<div class="viewcode-block" id="descent"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.descent">[docs]</a><span class="k">def</span> <span class="nf">descent</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a non-trivial solution, (x, y, z), to `x^2 = Ay^2 + Bz^2`</span>
<span class="sd">    using Lagrange&#39;s descent method with lattice-reduction. `A` and `B`</span>
<span class="sd">    are assumed to be valid for such a solution to exist.</span>

<span class="sd">    This is faster than the normal Lagrange&#39;s descent algorithm because</span>
<span class="sd">    the Gaussian reduction is used.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; descent(3, 1)  # x**2 = 3*y**2 + z**2</span>
<span class="sd">    (1, 0, 1)</span>

<span class="sd">    `(x, y, z) = (1, 0, 1)` is a solution to the above equation.</span>

<span class="sd">    &gt;&gt;&gt; descent(41, -113)</span>
<span class="sd">    (-16, -3, 1)</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    * Efficient Solution of Rational Conices, J. E. Cremona and D. Rusin,</span>
<span class="sd">      Mathematics of Computation, Volume 00, Number 0.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">B</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">descent</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">y</span>

    <span class="k">if</span> <span class="n">B</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">A</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">B</span> <span class="o">==</span> <span class="o">-</span><span class="n">A</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">B</span> <span class="o">==</span> <span class="n">A</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">descent</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span>

    <span class="n">w</span> <span class="o">=</span> <span class="n">sqrt_mod</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
    <span class="n">x_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">gaussian_reduce</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>

    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_0</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">A</span><span class="o">*</span><span class="n">z_0</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="n">B</span>
    <span class="n">t_2</span> <span class="o">=</span> <span class="n">square_factor</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">t_1</span> <span class="o">=</span> <span class="n">t</span> <span class="o">//</span> <span class="n">t_2</span><span class="o">**</span><span class="mi">2</span>

    <span class="n">x_1</span><span class="p">,</span> <span class="n">z_1</span><span class="p">,</span> <span class="n">y_1</span> <span class="o">=</span> <span class="n">descent</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">t_1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_remove_gcd</span><span class="p">(</span><span class="n">x_0</span><span class="o">*</span><span class="n">x_1</span> <span class="o">+</span> <span class="n">A</span><span class="o">*</span><span class="n">z_0</span><span class="o">*</span><span class="n">z_1</span><span class="p">,</span> <span class="n">z_0</span><span class="o">*</span><span class="n">x_1</span> <span class="o">+</span> <span class="n">x_0</span><span class="o">*</span><span class="n">z_1</span><span class="p">,</span> <span class="n">t_1</span><span class="o">*</span><span class="n">t_2</span><span class="o">*</span><span class="n">y_1</span><span class="p">)</span></div>


<div class="viewcode-block" id="gaussian_reduce"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.gaussian_reduce">[docs]</a><span class="k">def</span> <span class="nf">gaussian_reduce</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a reduced solution `(x, z)` to the congruence</span>
<span class="sd">    `X^2 - aZ^2 \equiv 0 \ (mod \ b)` so that `x^2 + |a|z^2` is minimal.</span>

<span class="sd">    Here ``w`` is a solution of the congruence `x^2 \equiv a \ (mod \ b)`</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    * Efficient Solution of Rational Conices, J. E. Cremona and D. Rusin,</span>
<span class="sd">      Mathematics of Computation, Volume 00, Number 0.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">norm</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">,</span> <span class="n">u</span>

    <span class="k">while</span> <span class="n">norm</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">//</span> <span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">,</span> <span class="n">u</span>

    <span class="k">if</span> <span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">norm</span><span class="p">((</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">w</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<span class="k">def</span> <span class="nf">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a special dot product of the vectors `u = (u_{1}, u_{2})` and</span>
<span class="sd">    `v = (v_{1}, v_{2})` which is defined in order to reduce solution of</span>
<span class="sd">    the congruence equation `X^2 - aZ^2 \equiv 0 \ (mod \ b)`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u_1</span><span class="p">,</span> <span class="n">u_2</span> <span class="o">=</span> <span class="n">u</span>
    <span class="n">v_1</span><span class="p">,</span> <span class="n">v_2</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">u_1</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">u_2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">v_1</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">v_2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">u_1</span><span class="o">*</span><span class="n">v_1</span>


<span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the norm of the vector `u = (u_{1}, u_{2})` under the dot product</span>
<span class="sd">    defined by `u \cdot v = (wu_{1} + bu_{2})(w*v_{1} + bv_{2}) + |a|*u_{1}*v_{1}`</span>
<span class="sd">    where `u = (u_{1}, u_{2})` and `v = (v_{1}, v_{2})`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u_1</span><span class="p">,</span> <span class="n">u_2</span> <span class="o">=</span> <span class="n">u</span>
    <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dot</span><span class="p">((</span><span class="n">u_1</span><span class="p">,</span> <span class="n">u_2</span><span class="p">),</span> <span class="p">(</span><span class="n">u_1</span><span class="p">,</span> <span class="n">u_2</span><span class="p">),</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>


<div class="viewcode-block" id="holzer"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.holzer">[docs]</a><span class="k">def</span> <span class="nf">holzer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simplify the solution `(x, y, z)` of the equation</span>
<span class="sd">    `ax^2 + by^2 = cz^2` with `a, b, c &gt; 0` and `z^2 \geq \mid ab \mid` to</span>
<span class="sd">    a new reduced solution `(x&#39;, y&#39;, z&#39;)` such that `z&#39;^2 \leq \mid ab \mid`.</span>

<span class="sd">    The algorithm is an interpretation of Mordell&#39;s reduction as described</span>
<span class="sd">    on page 8 of Cremona and Rusin&#39;s paper and the work of Mordell.</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    * Efficient Solution of Rational Conices, J. E. Cremona and D. Rusin,</span>
<span class="sd">      Mathematics of Computation, Volume 00, Number 0.</span>
<span class="sd">    * Diophantine Equations, L. J. Mordell, page 48.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">_odd</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">c</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">c</span><span class="o">//</span><span class="mi">2</span>

    <span class="n">small</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">c</span>
    <span class="n">step</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">t3</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">*</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1"># check that it&#39;s a solution</span>
        <span class="k">if</span> <span class="n">t1</span> <span class="o">+</span> <span class="n">t2</span> <span class="o">!=</span> <span class="n">t3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;bad starting solution&#39;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
        <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">t3</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">small</span><span class="p">:</span>
            <span class="c1"># Holzer condition</span>
            <span class="k">break</span>

        <span class="n">uv</span> <span class="o">=</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">base_solution_linear</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="o">-</span><span class="n">x_0</span><span class="p">)</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">uv</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">u</span><span class="o">*</span><span class="n">x_0</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">v</span><span class="o">*</span><span class="n">y_0</span><span class="p">),</span> <span class="n">c</span><span class="o">*</span><span class="n">z_0</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">Rational</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_even</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">_nint_or_floor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">r</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">p</span><span class="o">//</span><span class="n">q</span>  <span class="c1"># floor</span>
            <span class="k">if</span> <span class="n">_odd</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">v</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">w</span><span class="p">):</span>
                <span class="n">w</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">r</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>

        <span class="n">A</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">u</span><span class="o">*</span><span class="n">x_0</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">v</span><span class="o">*</span><span class="n">y_0</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">z_0</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">Rational</span><span class="p">(</span><span class="n">x_0</span><span class="o">*</span><span class="n">A</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">u</span><span class="o">*</span><span class="n">B</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">Rational</span><span class="p">(</span><span class="n">y_0</span><span class="o">*</span><span class="n">A</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="o">*</span><span class="n">B</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">Rational</span><span class="p">(</span><span class="n">z_0</span><span class="o">*</span><span class="n">A</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">B</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">is_Integer</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
        <span class="n">step</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">))</span></div>


<div class="viewcode-block" id="diop_general_pythagorean"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.diop_general_pythagorean">[docs]</a><span class="k">def</span> <span class="nf">diop_general_pythagorean</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves the general pythagorean equation,</span>
<span class="sd">    `a_{1}^2x_{1}^2 + a_{2}^2x_{2}^2 + . . . + a_{n}^2x_{n}^2 - a_{n + 1}^2x_{n + 1}^2 = 0`.</span>

<span class="sd">    Returns a tuple which contains a parametrized solution to the equation,</span>
<span class="sd">    sorted in the same order as the input variables.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    eq : Expr</span>
<span class="sd">        is a general pythagorean equation which is assumed to be zero</span>
<span class="sd">    param : Symbol, optional</span>
<span class="sd">       is the base parameter used to construct other parameters by subscripting.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from diofant.abc import e</span>
<span class="sd">    &gt;&gt;&gt; diop_general_pythagorean(a**2 + b**2 + c**2 - d**2)</span>
<span class="sd">    (m1**2 + m2**2 - m3**2, 2*m1*m3, 2*m2*m3, m1**2 + m2**2 + m3**2)</span>
<span class="sd">    &gt;&gt;&gt; diop_general_pythagorean(9*a**2 - 4*b**2 + 16*c**2 + 25*d**2 + e**2)</span>
<span class="sd">    (10*m1**2  + 10*m2**2  + 10*m3**2 - 10*m4**2, 15*m1**2  + 15*m2**2  + 15*m3**2  + 15*m4**2, 15*m1*m4, 12*m2*m4, 60*m3*m4)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">diop_type</span> <span class="o">==</span> <span class="s2">&quot;general_pythagorean&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_diop_general_pythagorean</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_diop_general_pythagorean</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">sign</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">sign</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">sign</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">coeff</span><span class="p">):</span>
            <span class="n">coeff</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">coeff</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">sign</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">i</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">1:</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ith</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m_i</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">m_i</span> <span class="ow">in</span> <span class="n">m</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="n">ith</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">L</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">m</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)])</span>
    <span class="n">sol</span> <span class="o">=</span> <span class="n">L</span><span class="p">[:</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">ith</span><span class="p">]</span> <span class="o">+</span> <span class="n">L</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>

    <span class="n">lcm</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">index</span> <span class="ow">or</span> <span class="p">(</span><span class="n">index</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">lcm</span> <span class="o">=</span> <span class="n">ilcm</span><span class="p">(</span><span class="n">lcm</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">])))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">lcm</span> <span class="o">=</span> <span class="n">ilcm</span><span class="p">(</span><span class="n">lcm</span><span class="p">,</span> <span class="n">s</span> <span class="k">if</span> <span class="n">_odd</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">else</span> <span class="n">s</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
        <span class="n">sol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lcm</span><span class="o">*</span><span class="n">sol</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">]))</span>

    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>


<div class="viewcode-block" id="diop_general_sum_of_squares"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.diop_general_sum_of_squares">[docs]</a><span class="k">def</span> <span class="nf">diop_general_sum_of_squares</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves the equation `x_{1}^2 + x_{2}^2 + . . . + x_{n}^2 - k = 0`.</span>

<span class="sd">    Returns at most ``limit`` number of solutions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    eq : Expr</span>
<span class="sd">        is an expression which is assumed to be zero. Also, ``eq`` should be in the form,</span>
<span class="sd">        `x_{1}^2 + x_{2}^2 + . . . + x_{n}^2 - k = 0`.</span>
<span class="sd">    limit : int, optional</span>
<span class="sd">        upper limit (the default is 1) for number of solutions returned.</span>

<span class="sd">    Notes</span>
<span class="sd">    =====</span>

<span class="sd">    When `n = 3` if `k = 4^a(8m + 7)` for some `a, m \in Z` then there will be</span>
<span class="sd">    no solutions.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from diofant.abc import e, f</span>
<span class="sd">    &gt;&gt;&gt; diop_general_sum_of_squares(a**2 + b**2 + c**2 + d**2 + e**2 - 2345)</span>
<span class="sd">    {(15, 22, 22, 24, 24)}</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    * Representing an integer as a sum of three squares, [online],</span>
<span class="sd">      Available:</span>
<span class="sd">      https://proofwiki.org/wiki/Integer_as_Sum_of_Three_Squares</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">diop_type</span> <span class="o">==</span> <span class="s2">&quot;general_sum_of_squares&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_diop_general_sum_of_squares</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">limit</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_diop_general_sum_of_squares</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># solves Eq(sum(i**2 for i in var), k)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n must be greater than 2&#39;</span><span class="p">)</span>

    <span class="n">s</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">limit</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="n">sign</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_nonpositive</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">var</span><span class="p">]</span>
    <span class="n">negs</span> <span class="o">=</span> <span class="n">sign</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>

    <span class="n">took</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">sum_of_squares</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">zeros</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">negs</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">sign</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">j</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">took</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">took</span> <span class="o">==</span> <span class="n">limit</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">s</span>


<div class="viewcode-block" id="diop_general_sum_of_even_powers"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.diop_general_sum_of_even_powers">[docs]</a><span class="k">def</span> <span class="nf">diop_general_sum_of_even_powers</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves the equation `x_{1}^e + x_{2}^e + . . . + x_{n}^e - k = 0`</span>
<span class="sd">    where `e` is an even, integer power.</span>

<span class="sd">    Returns at most ``limit`` number of solutions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    eq : Expr</span>
<span class="sd">        An expression which is assumed to be zero.  Also, ``eq`` should</span>
<span class="sd">        be in the form, `x_{1}^e + x_{2}^e + . . . + x_{n}^e - k = 0`.</span>
<span class="sd">    limit : Expr, optional</span>
<span class="sd">        Limit number of returned solutions.  Default is 1.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; diop_general_sum_of_even_powers(a**4 + b**4 - (2**4 + 3**4))</span>
<span class="sd">    {(2, 3)}</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.solvers.diophantine.power_representation</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">diop_type</span> <span class="o">==</span> <span class="s2">&quot;general_sum_of_even_powers&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">coeff</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">is_Pow</span> <span class="ow">and</span> <span class="n">coeff</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">exp</span>
        <span class="k">return</span> <span class="n">_diop_general_sum_of_even_powers</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="o">-</span><span class="n">coeff</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">limit</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_diop_general_sum_of_even_powers</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># solves Eq(sum(i**2 for i in var), n)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

    <span class="n">s</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">limit</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="n">sign</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_nonpositive</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">var</span><span class="p">]</span>
    <span class="n">negs</span> <span class="o">=</span> <span class="n">sign</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>

    <span class="n">took</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">power_representation</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">negs</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">sign</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">j</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">took</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">took</span> <span class="o">==</span> <span class="n">limit</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">s</span>


<span class="c1"># Functions below this comment can be more suitably grouped under</span>
<span class="c1"># an Additive number theory module rather than the Diophantine</span>
<span class="c1"># equation module.</span>


<div class="viewcode-block" id="partition"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.partition">[docs]</a><span class="k">def</span> <span class="nf">partition</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zeros</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a generator that can be used to generate partitions of an integer</span>
<span class="sd">    `n`.</span>

<span class="sd">    A partition of `n` is a set of positive integers which add up to `n`. For</span>
<span class="sd">    example, partitions of 3 are 3, 1 + 2, 1 + 1 + 1. A partition is returned</span>
<span class="sd">    as a tuple. If ``k`` equals None, then all possible partitions are returned</span>
<span class="sd">    irrespective of their size, otherwise only the partitions of size ``k`` are</span>
<span class="sd">    returned. If the ``zero`` parameter is set to True then a suitable</span>
<span class="sd">    number of zeros are added at the end of every partition of size less than</span>
<span class="sd">    ``k``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    n : int</span>
<span class="sd">        is a positive integer</span>
<span class="sd">    k : int, optional</span>
<span class="sd">        is the size of the partition which is also positive</span>
<span class="sd">        integer.  The default is ``None``.</span>
<span class="sd">    zeros : boolean, optional</span>
<span class="sd">        parameter is considered only if ``k`` is not ``None``. When the</span>
<span class="sd">        partitions are over, the last `next()` call throws the ``StopIteration``</span>
<span class="sd">        exception, so this function should always be used inside a</span>
<span class="sd">        try - except block.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; f = partition(5)</span>
<span class="sd">    &gt;&gt;&gt; next(f)</span>
<span class="sd">    (1, 1, 1, 1, 1)</span>
<span class="sd">    &gt;&gt;&gt; next(f)</span>
<span class="sd">    (1, 1, 1, 2)</span>
<span class="sd">    &gt;&gt;&gt; g = partition(5, 3)</span>
<span class="sd">    &gt;&gt;&gt; next(g)</span>
<span class="sd">    (1, 1, 3)</span>
<span class="sd">    &gt;&gt;&gt; next(g)</span>
<span class="sd">    (1, 2, 2)</span>
<span class="sd">    &gt;&gt;&gt; g = partition(5, 3, zeros=True)</span>
<span class="sd">    &gt;&gt;&gt; next(g)</span>
<span class="sd">    (0, 0, 5)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">diofant.utilities.iterables</span> <span class="k">import</span> <span class="n">ordered_partitions</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">zeros</span> <span class="ow">or</span> <span class="n">k</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ordered_partitions</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">yield</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ordered_partitions</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
                <span class="n">i</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">yield</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span><span class="o">*</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">+</span> <span class="n">i</span></div>


<div class="viewcode-block" id="prime_as_sum_of_two_squares"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.prime_as_sum_of_two_squares">[docs]</a><span class="k">def</span> <span class="nf">prime_as_sum_of_two_squares</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represent a prime `p` as a unique sum of two squares; this can</span>
<span class="sd">    only be done if the prime is congruent to 1 mod 4.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; prime_as_sum_of_two_squares(7)  # can&#39;t be done</span>
<span class="sd">    &gt;&gt;&gt; prime_as_sum_of_two_squares(5)</span>
<span class="sd">    (1, 2)</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    * Representing a number as a sum of four squares, [online],</span>
<span class="sd">      Available: https://schorn.ch/lagrange.html</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.solvers.diophantine.sum_of_squares</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">p</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="k">while</span> <span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">nextprime</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="n">b</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">p</span>

    <span class="k">while</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span>

    <span class="k">return</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">,</span> <span class="n">b</span></div>


<div class="viewcode-block" id="sum_of_three_squares"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.sum_of_three_squares">[docs]</a><span class="k">def</span> <span class="nf">sum_of_three_squares</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a 3-tuple `(a, b, c)` such that `a^2 + b^2 + c^2 = n` and</span>
<span class="sd">    `a, b, c \geq 0`.</span>

<span class="sd">    Returns None if `n = 4^a(8m + 7)` for some `a, m \in Z`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    n : int</span>
<span class="sd">        a non-negative integer.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; sum_of_three_squares(44542)</span>
<span class="sd">    (18, 37, 207)</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    * Representing a number as a sum of three squares, [online],</span>
<span class="sd">      Available: https://schorn.ch/lagrange.html</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.solvers.diophantine.sum_of_squares</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">special</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">3</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">10</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">34</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">58</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
               <span class="mi">85</span><span class="p">:</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">130</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">214</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="mi">226</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="mi">370</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
               <span class="mi">526</span><span class="p">:</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="mi">706</span><span class="p">:</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="mi">730</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1414</span><span class="p">:</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">33</span><span class="p">),</span> <span class="mi">1906</span><span class="p">:</span> <span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">36</span><span class="p">),</span>
               <span class="mi">2986</span><span class="p">:</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">39</span><span class="p">),</span> <span class="mi">9634</span><span class="p">:</span> <span class="p">(</span><span class="mi">56</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">57</span><span class="p">)}</span>

    <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">multiplicity</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">//=</span> <span class="mi">4</span><span class="o">**</span><span class="n">v</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">special</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">special</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">_sorted_tuple</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>

    <span class="n">s</span><span class="p">,</span> <span class="n">_exact</span> <span class="o">=</span> <span class="n">integer_nthroot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_exact</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

    <span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="k">if</span> <span class="n">_odd</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">else</span> <span class="n">s</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">):</span>  <span class="c1"># pragma: no branch</span>
            <span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="n">isprime</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">prime_as_sum_of_two_squares</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">_sorted_tuple</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">z</span><span class="p">),</span> <span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">z</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="k">if</span> <span class="n">_odd</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">else</span> <span class="n">s</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">_odd</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">else</span> <span class="n">s</span>

    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">):</span>  <span class="c1"># pragma: no branch</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">isprime</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">prime_as_sum_of_two_squares</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_sorted_tuple</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">z</span><span class="p">)</span></div>


<div class="viewcode-block" id="sum_of_four_squares"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.sum_of_four_squares">[docs]</a><span class="k">def</span> <span class="nf">sum_of_four_squares</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a 4-tuple `(a, b, c, d)` such that `a^2 + b^2 + c^2 + d^2 = n`.</span>

<span class="sd">    Here `a, b, c, d \geq 0`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    n : int</span>
<span class="sd">        is a non-negative integer.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; sum_of_four_squares(3456)</span>
<span class="sd">    (8, 8, 32, 48)</span>
<span class="sd">    &gt;&gt;&gt; sum_of_four_squares(1294585930293)</span>
<span class="sd">    (0, 1234, 2161, 1137796)</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    * Representing a number as a sum of four squares, [online],</span>
<span class="sd">      Available: https://schorn.ch/lagrange.html</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.solvers.diophantine.sum_of_squares</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">multiplicity</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">//=</span> <span class="mi">4</span><span class="o">**</span><span class="n">v</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">4</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">sum_of_three_squares</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_sorted_tuple</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">z</span><span class="p">)</span></div>


<div class="viewcode-block" id="power_representation"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.power_representation">[docs]</a><span class="k">def</span> <span class="nf">power_representation</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">zeros</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a generator for finding k-tuples of integers,</span>
<span class="sd">    `(n_{1}, n_{2}, ... n_{k})`, such that</span>
<span class="sd">    `n = n_{1}^p + n_{2}^p + ... n_{k}^p`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    n : int</span>
<span class="sd">        a non-negative integer</span>
<span class="sd">    k, p : int</span>
<span class="sd">        parameters to control representation ``n`` as a sum</span>
<span class="sd">        of ``k``, ``p``-th powers.</span>
<span class="sd">    zeros : boolean, optional</span>
<span class="sd">        if ``True`` (the default is ``False``), then the solutions</span>
<span class="sd">        will contain zeros.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    Represent 1729 as a sum of two cubes:</span>

<span class="sd">    &gt;&gt;&gt; f = power_representation(1729, 3, 2)</span>
<span class="sd">    &gt;&gt;&gt; next(f)</span>
<span class="sd">    (9, 10)</span>
<span class="sd">    &gt;&gt;&gt; next(f)</span>
<span class="sd">    (1, 12)</span>

<span class="sd">    If the flag `zeros` is True, the solution may contain tuples with</span>
<span class="sd">    zeros; any such solutions will be generated after the solutions</span>
<span class="sd">    without zeros:</span>

<span class="sd">    &gt;&gt;&gt; list(power_representation(125, 2, 3, zeros=True))</span>
<span class="sd">    [(5, 6, 8), (3, 4, 10), (0, 5, 10), (0, 2, 11)]</span>

<span class="sd">    For even `p` the `permute_sign` function can be used to get all</span>
<span class="sd">    signed values:</span>

<span class="sd">    &gt;&gt;&gt; from diofant.utilities.iterables import permute_signs</span>
<span class="sd">    &gt;&gt;&gt; list(permute_signs((1, 12)))</span>
<span class="sd">    [(1, 12), (-1, 12), (1, -12), (-1, -12)]</span>

<span class="sd">    All possible signed permutations can also be obtained:</span>

<span class="sd">    &gt;&gt;&gt; from diofant.utilities.iterables import signed_permutations</span>
<span class="sd">    &gt;&gt;&gt; list(signed_permutations((1, 12)))</span>
<span class="sd">    [(1, 12), (-1, 12), (1, -12), (-1, -12), (12, 1), (-12, 1),</span>
<span class="sd">     (12, -1), (-12, -1)]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="n">as_int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">power_representation</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">zeros</span><span class="p">):</span>
                <span class="k">yield</span> <span class="nb">tuple</span><span class="p">(</span><span class="o">-</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">filldedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    Expecting positive integers for `(p, k)`, but got `(</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)`&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">zeros</span><span class="p">:</span>
            <span class="k">yield</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span><span class="o">*</span><span class="n">k</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">n</span><span class="p">,</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">be</span> <span class="o">=</span> <span class="n">perfect_power</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">be</span><span class="p">:</span>
                <span class="n">b</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">be</span>
                <span class="n">d</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">b</span><span class="o">**</span><span class="n">d</span><span class="p">,</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">partition</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">zeros</span><span class="o">=</span><span class="n">zeros</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">t</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">feasible</span> <span class="o">=</span> <span class="n">_can_do_sum_of_squares</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">feasible</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">zeros</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">33</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">n</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">-</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
                                                                    <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># Todd G. Will, &quot;When Is n^2 a Sum of k Squares?&quot;, [online].</span>
            <span class="c1"># Available: https://www.maa.org/sites/default/files/Will-MMz-201037918.pdf</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">feasible</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># it&#39;s prime and k == 2</span>
            <span class="k">yield</span> <span class="n">prime_as_sum_of_two_squares</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">return</span>

    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">be</span> <span class="o">=</span> <span class="n">perfect_power</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">be</span> <span class="ow">and</span> <span class="n">be</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># Fermat: a**n + b**n = c**n has no solution for n &gt; 2</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="n">k</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">integer_nthroot</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">p</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">pow_rep_recursive</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="p">[],</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">yield</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">zeros</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">integer_nthroot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">pow_rep_recursive</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="p">[],</span> <span class="n">p</span><span class="p">):</span>
                <span class="k">yield</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span><span class="o">*</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="n">i</span><span class="p">)))</span></div>


<span class="n">sum_of_powers</span> <span class="o">=</span> <span class="n">power_representation</span>


<span class="k">def</span> <span class="nf">pow_rep_recursive</span><span class="p">(</span><span class="n">n_i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n_remaining</span><span class="p">,</span> <span class="n">terms</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">n_remaining</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">yield</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n_i</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">pow_rep_recursive</span><span class="p">(</span><span class="n">n_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n_remaining</span><span class="p">,</span> <span class="n">terms</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">t</span>
            <span class="n">residual</span> <span class="o">=</span> <span class="n">n_remaining</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="n">n_i</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">residual</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">pow_rep_recursive</span><span class="p">(</span><span class="n">n_i</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">residual</span><span class="p">,</span> <span class="n">terms</span> <span class="o">+</span> <span class="p">[</span><span class="n">n_i</span><span class="p">],</span> <span class="n">p</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">t</span>


<div class="viewcode-block" id="sum_of_squares"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#diofant.solvers.diophantine.sum_of_squares">[docs]</a><span class="k">def</span> <span class="nf">sum_of_squares</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">zeros</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a generator that yields the k-tuples of nonnegative</span>
<span class="sd">    values, the squares of which sum to n. If zeros is False (default)</span>
<span class="sd">    then the solution will not contain zeros. The nonnegative</span>
<span class="sd">    elements of a tuple are sorted.</span>

<span class="sd">    * If k == 1 and n is square, (n,) is returned.</span>

<span class="sd">    * If k == 2 then n can only be written as a sum of squares if</span>
<span class="sd">      every prime in the factorization of n that has the form</span>
<span class="sd">      4*k + 3 has an even multiplicity. If n is prime then</span>
<span class="sd">      it can only be written as a sum of two squares if it is</span>
<span class="sd">      in the form 4*k + 1.</span>

<span class="sd">    * if k == 3 then n can be written as a sum of squares if it does</span>
<span class="sd">      not have the form 4**m*(8*k + 7).</span>

<span class="sd">    * all integers can be written as the sum of 4 squares.</span>

<span class="sd">    * if k &gt; 4 then n can be partitioned and each partition can</span>
<span class="sd">      be written as a sum of 4 squares; if n is not evenly divisible</span>
<span class="sd">      by 4 then n can be written as a sum of squares only if the</span>
<span class="sd">      an additional partition can be written as as sum of squares.</span>
<span class="sd">      For example, if k = 6 then n is partitioned into two parts,</span>
<span class="sd">      the first being written as a sum of 4 squares and the second</span>
<span class="sd">      being written as a sum of 2 squares -- which can only be</span>
<span class="sd">      done if the contition above for k = 2 can be met, so this will</span>
<span class="sd">      automatically reject certain partitions of n.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; list(sum_of_squares(25, 2))</span>
<span class="sd">    [(3, 4)]</span>
<span class="sd">    &gt;&gt;&gt; list(sum_of_squares(25, 2, True))</span>
<span class="sd">    [(3, 4), (0, 5)]</span>
<span class="sd">    &gt;&gt;&gt; list(sum_of_squares(25, 4))</span>
<span class="sd">    [(1, 2, 2, 4)]</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.utilities.iterables.signed_permutations</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">power_representation</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">zeros</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">t</span></div>


<span class="k">def</span> <span class="nf">_can_do_sum_of_squares</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return True if n can be written as the sum of k squares,</span>
<span class="sd">    False if it can&#39;t, or 1 if k == 2 and n is prime (in which</span>
<span class="sd">    case it *can* be written as a sum of two squares). A False</span>
<span class="sd">    is returned only if it can&#39;t be written as k-squares, even</span>
<span class="sd">    if 0s are allowed.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">is_square</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">isprime</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">2</span>  <span class="c1"># signal that it was prime</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">factorint</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># we can proceed iff no prime factor in the form 4*k + 3</span>
                <span class="c1"># has an odd multiplicity</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="n">m</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="o">//</span><span class="mi">4</span><span class="o">**</span><span class="n">multiplicity</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="c1"># every number can be written as a sum of 4 squares; for k &gt; 4 partitions</span>
    <span class="c1"># can be 0</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2006-2018 SymPy Development Team, 2013-2019 Sergey B Kirpichev

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>