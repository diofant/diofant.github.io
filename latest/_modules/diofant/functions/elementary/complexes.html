

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>diofant.functions.elementary.complexes &mdash; Diofant 0.10.0a3.dev8+gf2667d6f31 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html" class="icon icon-home"> Diofant
          

          
          </a>

          
            
            
              <div class="version">
                0.10.0a3.dev8+gf2667d6f31
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../internals/index.html">Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../literature.html">Literature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guide.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../aboutus.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../release/index.html">Release Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Diofant</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>diofant.functions.elementary.complexes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for diofant.functions.elementary.complexes</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">...core</span> <span class="k">import</span> <span class="p">(</span><span class="n">Add</span><span class="p">,</span> <span class="n">Derivative</span><span class="p">,</span> <span class="n">Dummy</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">Eq</span><span class="p">,</span> <span class="n">Expr</span><span class="p">,</span> <span class="n">Function</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">Mul</span><span class="p">,</span>
                     <span class="n">Rational</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">factor_terms</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="n">oo</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span>
                     <span class="n">sympify</span><span class="p">,</span> <span class="n">zoo</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">...core.function</span> <span class="k">import</span> <span class="n">AppliedUndef</span><span class="p">,</span> <span class="n">ArgumentIndexError</span>
<span class="kn">from</span> <span class="nn">...logic.boolalg</span> <span class="k">import</span> <span class="n">BooleanAtom</span>
<span class="kn">from</span> <span class="nn">.exponential</span> <span class="k">import</span> <span class="n">exp</span><span class="p">,</span> <span class="n">exp_polar</span><span class="p">,</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">.miscellaneous</span> <span class="k">import</span> <span class="n">sqrt</span>
<span class="kn">from</span> <span class="nn">.piecewise</span> <span class="k">import</span> <span class="n">Piecewise</span>
<span class="kn">from</span> <span class="nn">.trigonometric</span> <span class="k">import</span> <span class="n">atan2</span>


<span class="c1">###############################################################################</span>
<span class="c1"># ####################### REAL and IMAGINARY PARTS ########################## #</span>
<span class="c1">###############################################################################</span>


<div class="viewcode-block" id="re"><a class="viewcode-back" href="../../../../modules/functions/elementary.html#diofant.functions.elementary.complexes.re">[docs]</a><span class="k">class</span> <span class="nc">re</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns real part of expression.</span>

<span class="sd">    This function performs only elementary analysis and so it will fail to</span>
<span class="sd">    decompose properly more complicated expressions. If completely simplified</span>
<span class="sd">    result is needed then use Basic.as_real_imag() or perform complex</span>
<span class="sd">    expansion on instance of this function.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; re(2*E)</span>
<span class="sd">    2*E</span>
<span class="sd">    &gt;&gt;&gt; re(2*I + 17)</span>
<span class="sd">    17</span>
<span class="sd">    &gt;&gt;&gt; re(2*I)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; re(im(x) + x*I + 2)</span>
<span class="sd">    2</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.functions.elementary.complexes.im</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">is_extended_real</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">unbranched</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># implicitely works on the projection to C</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="n">zoo</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">nan</span>
        <span class="k">elif</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">arg</span>
        <span class="k">elif</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_imaginary</span> <span class="ow">or</span> <span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="n">arg</span><span class="p">)</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
        <span class="k">elif</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Function</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">conjugate</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">re</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="n">included</span><span class="p">,</span> <span class="n">reverted</span><span class="p">,</span> <span class="n">excluded</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">Add</span><span class="o">.</span><span class="n">make_args</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="n">coeff</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">as_coefficient</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">coeff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">coeff</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
                        <span class="n">reverted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">term</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="ow">and</span> <span class="n">term</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
                    <span class="n">excluded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Try to do some advanced expansion.  If</span>
                    <span class="c1"># impossible, don&#39;t try to do re(arg) again</span>
                    <span class="c1"># (because this is what we are trying to do now).</span>
                    <span class="n">real_imag</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">as_real_imag</span><span class="p">(</span><span class="n">ignore</span><span class="o">=</span><span class="n">arg</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">real_imag</span><span class="p">:</span>
                        <span class="n">excluded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">real_imag</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">included</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">included</span><span class="p">):</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">Add</span><span class="p">(</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span> <span class="k">for</span> <span class="n">xs</span> <span class="ow">in</span> <span class="p">[</span><span class="n">included</span><span class="p">,</span> <span class="n">reverted</span><span class="p">,</span> <span class="n">excluded</span><span class="p">])</span>

                <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">im</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span>

<div class="viewcode-block" id="re.as_real_imag"><a class="viewcode-back" href="../../../../modules/functions/elementary.html#diofant.functions.elementary.complexes.re.as_real_imag">[docs]</a>    <span class="k">def</span> <span class="nf">as_real_imag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the real number with a zero imaginary part.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span></div>

    <span class="k">def</span> <span class="nf">_eval_derivative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_extended_real</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">re</span><span class="p">(</span><span class="n">Derivative</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">is_imaginary</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_imaginary</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">I</span><span class="o">*</span><span class="n">im</span><span class="p">(</span><span class="n">Derivative</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_eval_rewrite_as_im</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">I</span><span class="o">*</span><span class="n">im</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_eval_is_algebraic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_algebraic</span></div>


<div class="viewcode-block" id="im"><a class="viewcode-back" href="../../../../modules/functions/elementary.html#diofant.functions.elementary.complexes.im">[docs]</a><span class="k">class</span> <span class="nc">im</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns imaginary part of expression.</span>

<span class="sd">    This function performs only elementary analysis and so it will fail to</span>
<span class="sd">    decompose properly more complicated expressions. If completely simplified</span>
<span class="sd">    result is needed then use Basic.as_real_imag() or perform complex expansion</span>
<span class="sd">    on instance of this function.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; im(2*E)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; re(2*I + 17)</span>
<span class="sd">    17</span>
<span class="sd">    &gt;&gt;&gt; im(x*I)</span>
<span class="sd">    re(x)</span>
<span class="sd">    &gt;&gt;&gt; im(re(x) + y)</span>
<span class="sd">    im(y)</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.functions.elementary.complexes.re</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">is_extended_real</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">unbranched</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># implicitely works on the projection to C</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="n">zoo</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">nan</span>
        <span class="k">elif</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
        <span class="k">elif</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_imaginary</span> <span class="ow">or</span> <span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="n">arg</span><span class="p">)</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">I</span> <span class="o">*</span> <span class="n">arg</span>
        <span class="k">elif</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Function</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">conjugate</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">im</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">included</span><span class="p">,</span> <span class="n">reverted</span><span class="p">,</span> <span class="n">excluded</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">Add</span><span class="o">.</span><span class="n">make_args</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="n">coeff</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">as_coefficient</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">coeff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">coeff</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
                        <span class="n">reverted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">excluded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">term</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">term</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
                    <span class="c1"># Try to do some advanced expansion.  If</span>
                    <span class="c1"># impossible, don&#39;t try to do im(arg) again</span>
                    <span class="c1"># (because this is what we are trying to do now).</span>
                    <span class="n">real_imag</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">as_real_imag</span><span class="p">(</span><span class="n">ignore</span><span class="o">=</span><span class="n">arg</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">real_imag</span><span class="p">:</span>
                        <span class="n">excluded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">real_imag</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">included</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">included</span><span class="p">):</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">Add</span><span class="p">(</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span> <span class="k">for</span> <span class="n">xs</span> <span class="ow">in</span> <span class="p">[</span><span class="n">included</span><span class="p">,</span> <span class="n">reverted</span><span class="p">,</span> <span class="n">excluded</span><span class="p">])</span>

                <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">re</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span>

<div class="viewcode-block" id="im.as_real_imag"><a class="viewcode-back" href="../../../../modules/functions/elementary.html#diofant.functions.elementary.complexes.im.as_real_imag">[docs]</a>    <span class="k">def</span> <span class="nf">as_real_imag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the imaginary part with a zero real part.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; im(2 + 3*I).as_real_imag()</span>
<span class="sd">        (3, 0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span></div>

    <span class="k">def</span> <span class="nf">_eval_derivative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_extended_real</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">im</span><span class="p">(</span><span class="n">Derivative</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">is_imaginary</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_imaginary</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">I</span><span class="o">*</span><span class="n">re</span><span class="p">(</span><span class="n">Derivative</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_eval_rewrite_as_re</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">I</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">re</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_eval_is_algebraic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_algebraic</span></div>


<span class="c1">###############################################################################</span>
<span class="c1"># ############# SIGN, ABSOLUTE VALUE, ARGUMENT and CONJUGATION ############## #</span>
<span class="c1">###############################################################################</span>

<div class="viewcode-block" id="sign"><a class="viewcode-back" href="../../../../modules/functions/elementary.html#diofant.functions.elementary.complexes.sign">[docs]</a><span class="k">class</span> <span class="nc">sign</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the complex sign of an expression.</span>

<span class="sd">    If the expression is real the sign will be:</span>

<span class="sd">        * 1 if expression is positive</span>
<span class="sd">        * 0 if expression is equal to zero</span>
<span class="sd">        * -1 if expression is negative</span>

<span class="sd">    If the expression is imaginary the sign will be:</span>

<span class="sd">        * I if im(expression) is positive</span>
<span class="sd">        * -I if im(expression) is negative</span>

<span class="sd">    Otherwise an unevaluated expression will be returned. When evaluated, the</span>
<span class="sd">    result (in general) will be ``cos(arg(expr)) + I*sin(arg(expr))``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; sign(-1)</span>
<span class="sd">    -1</span>
<span class="sd">    &gt;&gt;&gt; sign(0)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; sign(-3*I)</span>
<span class="sd">    -I</span>
<span class="sd">    &gt;&gt;&gt; sign(1 + I)</span>
<span class="sd">    sign(1 + I)</span>
<span class="sd">    &gt;&gt;&gt; _.evalf()</span>
<span class="sd">    0.707106781186548 + 0.707106781186548*I</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.functions.elementary.complexes.Abs</span>
<span class="sd">    diofant.functions.elementary.complexes.conjugate</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">is_complex</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">doit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_nonzero</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">Abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="c1"># handle what we can</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Mul</span><span class="p">:</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">as_coeff_mul</span><span class="p">()</span>
            <span class="n">unk</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">is_negative</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span>
                <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">is_positive</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">is_imaginary</span> <span class="ow">and</span> <span class="n">im</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">is_comparable</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">*=</span> <span class="n">sign</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">unk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="n">S</span><span class="o">.</span><span class="n">One</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">unk</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="k">return</span> <span class="n">s</span> <span class="o">*</span> <span class="bp">cls</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">_new_rawargs</span><span class="p">(</span><span class="o">*</span><span class="n">unk</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_zero</span><span class="p">:</span>  <span class="c1"># it may be an Expr that is zero</span>
            <span class="k">return</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_positive</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">S</span><span class="o">.</span><span class="n">One</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_negative</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">S</span><span class="o">.</span><span class="n">NegativeOne</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Function</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">sign</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">arg</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_imaginary</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Pow</span> <span class="ow">and</span> <span class="n">arg</span><span class="o">.</span><span class="n">exp</span> <span class="ow">is</span> <span class="n">S</span><span class="o">.</span><span class="n">Half</span><span class="p">:</span>
                <span class="c1"># we catch this because non-trivial sqrt args are not expanded</span>
                <span class="c1"># e.g. sqrt(1-sqrt(2)) --x--&gt;  to I*sqrt(sqrt(2) - 1)</span>
                <span class="k">return</span> <span class="n">I</span>
            <span class="n">arg2</span> <span class="o">=</span> <span class="o">-</span><span class="n">I</span> <span class="o">*</span> <span class="n">arg</span>
            <span class="k">if</span> <span class="n">arg2</span><span class="o">.</span><span class="n">is_positive</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">I</span>

    <span class="k">def</span> <span class="nf">_eval_Abs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_nonzero</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">S</span><span class="o">.</span><span class="n">One</span>

    <span class="k">def</span> <span class="nf">_eval_conjugate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sign</span><span class="p">(</span><span class="n">conjugate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_eval_derivative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..special.delta_functions</span> <span class="k">import</span> <span class="n">DiracDelta</span>
            <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Derivative</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> \
                <span class="o">*</span> <span class="n">DiracDelta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_imaginary</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..special.delta_functions</span> <span class="k">import</span> <span class="n">DiracDelta</span>
            <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Derivative</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> \
                <span class="o">*</span> <span class="n">DiracDelta</span><span class="p">(</span><span class="o">-</span><span class="n">I</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_eval_is_nonnegative</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_nonnegative</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_eval_is_nonpositive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_nonpositive</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_eval_is_imaginary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_imaginary</span>

    <span class="k">def</span> <span class="nf">_eval_is_integer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_extended_real</span>

    <span class="k">def</span> <span class="nf">_eval_is_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_zero</span>

    <span class="k">def</span> <span class="nf">_eval_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_extended_real</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_nonzero</span> <span class="ow">and</span>
            <span class="n">other</span><span class="o">.</span><span class="n">is_integer</span> <span class="ow">and</span>
            <span class="n">other</span><span class="o">.</span><span class="n">is_even</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">S</span><span class="o">.</span><span class="n">One</span>

    <span class="k">def</span> <span class="nf">_eval_rewrite_as_Piecewise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Piecewise</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">arg</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">arg</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_eval_rewrite_as_Heaviside</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">Heaviside</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Heaviside</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_eval_simplify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">measure</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">factor</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_eval_nseries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">logx</span><span class="p">):</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_leading_term</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">as_coeff_exponent</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">direction</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_eval_nseries</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">logx</span><span class="p">)</span></div>


<div class="viewcode-block" id="Abs"><a class="viewcode-back" href="../../../../modules/functions/elementary.html#diofant.functions.elementary.complexes.Abs">[docs]</a><span class="k">class</span> <span class="nc">Abs</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the absolute value of the argument.</span>

<span class="sd">    This is an extension of the built-in function abs() to accept symbolic</span>
<span class="sd">    values.  If you pass a Diofant expression to the built-in abs(), it will</span>
<span class="sd">    pass it automatically to Abs().</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; Abs(-1)</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; x = Symbol(&#39;x&#39;, real=True)</span>
<span class="sd">    &gt;&gt;&gt; Abs(-x)</span>
<span class="sd">    Abs(x)</span>
<span class="sd">    &gt;&gt;&gt; Abs(x**2)</span>
<span class="sd">    x**2</span>
<span class="sd">    &gt;&gt;&gt; abs(-x) # The Python built-in</span>
<span class="sd">    Abs(x)</span>

<span class="sd">    Note that the Python built-in will return either an Expr or int depending on</span>
<span class="sd">    the argument::</span>

<span class="sd">        &gt;&gt;&gt; type(abs(-1))</span>
<span class="sd">        &lt;... &#39;int&#39;&gt;</span>
<span class="sd">        &gt;&gt;&gt; type(abs(S.NegativeOne))</span>
<span class="sd">        &lt;class &#39;diofant.core.numbers.One&#39;&gt;</span>

<span class="sd">    Abs will always return a diofant object.</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.functions.elementary.complexes.sign</span>
<span class="sd">    diofant.functions.elementary.complexes.conjugate</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">is_extended_real</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">is_negative</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">unbranched</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="Abs.fdiff"><a class="viewcode-back" href="../../../../modules/functions/elementary.html#diofant.functions.elementary.complexes.Abs.fdiff">[docs]</a>    <span class="k">def</span> <span class="nf">fdiff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argindex</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the first derivative of the argument to Abs().</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; Abs(-x).fdiff()</span>
<span class="sd">        sign(x)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">argindex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ArgumentIndexError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argindex</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">...simplify</span> <span class="k">import</span> <span class="n">signsimp</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="s1">&#39;_eval_Abs&#39;</span><span class="p">):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">_eval_Abs</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">obj</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Expr</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Bad argument type for Abs(): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
        <span class="c1"># handle what we can</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="n">signsimp</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Mul</span><span class="p">:</span>
            <span class="n">known</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">unk</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">arg</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                <span class="n">tnew</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tnew</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
                    <span class="n">unk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tnew</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">known</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tnew</span><span class="p">)</span>
            <span class="n">known</span> <span class="o">=</span> <span class="n">Mul</span><span class="p">(</span><span class="o">*</span><span class="n">known</span><span class="p">)</span>
            <span class="n">unk</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">Mul</span><span class="p">(</span><span class="o">*</span><span class="n">unk</span><span class="p">),</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">if</span> <span class="n">unk</span> <span class="k">else</span> <span class="n">S</span><span class="o">.</span><span class="n">One</span>
            <span class="k">return</span> <span class="n">known</span><span class="o">*</span><span class="n">unk</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Pow</span><span class="p">:</span>
            <span class="n">base</span><span class="p">,</span> <span class="n">exponent</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">as_base_exp</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">base</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">exponent</span><span class="o">.</span><span class="n">is_integer</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">exponent</span><span class="o">.</span><span class="n">is_even</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">arg</span>
                    <span class="k">if</span> <span class="n">base</span> <span class="ow">is</span> <span class="n">S</span><span class="o">.</span><span class="n">NegativeOne</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">S</span><span class="o">.</span><span class="n">One</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span> <span class="ow">and</span> <span class="n">exponent</span> <span class="ow">is</span> <span class="n">S</span><span class="o">.</span><span class="n">NegativeOne</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">arg</span>
                    <span class="k">return</span> <span class="n">Abs</span><span class="p">(</span><span class="n">base</span><span class="p">)</span><span class="o">**</span><span class="n">exponent</span>
                <span class="k">if</span> <span class="n">base</span><span class="o">.</span><span class="n">is_nonnegative</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">base</span><span class="o">**</span><span class="n">re</span><span class="p">(</span><span class="n">exponent</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">base</span><span class="o">.</span><span class="n">is_negative</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">base</span><span class="p">)</span><span class="o">**</span><span class="n">re</span><span class="p">(</span><span class="n">exponent</span><span class="p">)</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">pi</span><span class="o">*</span><span class="n">im</span><span class="p">(</span><span class="n">exponent</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_zero</span><span class="p">:</span>  <span class="c1"># it may be an Expr that is zero</span>
            <span class="k">return</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_nonnegative</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">arg</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_nonpositive</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">arg</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_imaginary</span><span class="p">:</span>
            <span class="n">arg2</span> <span class="o">=</span> <span class="o">-</span><span class="n">I</span> <span class="o">*</span> <span class="n">arg</span>
            <span class="k">if</span> <span class="n">arg2</span><span class="o">.</span><span class="n">is_nonnegative</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">arg2</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Add</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">is_infinite</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arg</span><span class="o">.</span><span class="n">as_real_imag</span><span class="p">()):</span>
                <span class="k">return</span> <span class="n">oo</span>
            <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_extended_real</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_imaginary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">is_extended_real</span> <span class="ow">or</span> <span class="n">a</span><span class="o">.</span><span class="n">is_imaginary</span> <span class="ow">or</span> <span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">is_extended_real</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arg</span><span class="o">.</span><span class="n">args</span><span class="p">):</span>
                    <span class="kn">from</span> <span class="nn">...core</span> <span class="k">import</span> <span class="n">expand_mul</span>
                    <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">expand_mul</span><span class="p">(</span><span class="n">arg</span><span class="o">*</span><span class="n">arg</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_extended_real</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_imaginary</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">...core</span> <span class="k">import</span> <span class="n">expand_mul</span>
            <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">expand_mul</span><span class="p">(</span><span class="n">arg</span><span class="o">*</span><span class="n">arg</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">_eval_is_integer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_integer</span>

    <span class="k">def</span> <span class="nf">_eval_is_nonzero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_nonzero</span>

    <span class="k">def</span> <span class="nf">_eval_is_finite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_complex</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_eval_is_positive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_nonzero</span>

    <span class="k">def</span> <span class="nf">_eval_is_rational</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_rational</span>

    <span class="k">def</span> <span class="nf">_eval_is_even</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_even</span>

    <span class="k">def</span> <span class="nf">_eval_is_odd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_odd</span>

    <span class="k">def</span> <span class="nf">_eval_is_algebraic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_algebraic</span>

    <span class="k">def</span> <span class="nf">_eval_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exponent</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_extended_real</span> <span class="ow">and</span> <span class="n">exponent</span><span class="o">.</span><span class="n">is_integer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exponent</span><span class="o">.</span><span class="n">is_even</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="n">exponent</span>
            <span class="k">elif</span> <span class="n">exponent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">S</span><span class="o">.</span><span class="n">NegativeOne</span> <span class="ow">and</span> <span class="n">exponent</span><span class="o">.</span><span class="n">is_Integer</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="n">exponent</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_eval_nseries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">logx</span><span class="p">):</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_leading_term</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">as_coeff_exponent</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_eval_nseries</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">logx</span><span class="o">=</span><span class="n">logx</span><span class="p">)</span>
        <span class="n">when</span><span class="p">,</span> <span class="n">lim</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">direction</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lim</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sign</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span><span class="o">*</span><span class="n">s</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Piecewise</span><span class="p">((</span><span class="n">lim</span><span class="p">,</span> <span class="n">when</span><span class="p">),</span> <span class="p">(</span><span class="n">sign</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_eval_derivative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_extended_real</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_imaginary</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Derivative</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> \
                <span class="o">*</span> <span class="n">sign</span><span class="p">(</span><span class="n">conjugate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">re</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">Derivative</span><span class="p">(</span><span class="n">re</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">x</span><span class="p">,</span>
                                              <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="n">im</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">Derivative</span><span class="p">(</span><span class="n">im</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                                                                             <span class="n">x</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span> <span class="o">/</span> <span class="n">Abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_eval_rewrite_as_Heaviside</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="c1"># Note this only holds for real arg (since Heaviside is not defined</span>
        <span class="c1"># for complex arguments).</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">Heaviside</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">arg</span><span class="o">*</span><span class="p">(</span><span class="n">Heaviside</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">-</span> <span class="n">Heaviside</span><span class="p">(</span><span class="o">-</span><span class="n">arg</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_eval_rewrite_as_Piecewise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Piecewise</span><span class="p">((</span><span class="n">arg</span><span class="p">,</span> <span class="n">arg</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">arg</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_eval_rewrite_as_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">arg</span><span class="o">/</span><span class="n">sign</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span></div>


<div class="viewcode-block" id="arg"><a class="viewcode-back" href="../../../../modules/functions/elementary.html#diofant.functions.elementary.complexes.arg">[docs]</a><span class="k">class</span> <span class="nc">arg</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the argument (in radians) of a complex number.</span>

<span class="sd">    For a real number, the argument is always 0.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; arg(2.0)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; arg(I)</span>
<span class="sd">    pi/2</span>
<span class="sd">    &gt;&gt;&gt; arg(sqrt(2) + I*sqrt(2))</span>
<span class="sd">    pi/4</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">is_real</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Atom</span><span class="p">:</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">arg_</span> <span class="o">=</span> <span class="n">factor_terms</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">.</span><span class="n">as_coeff_Mul</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">arg_</span><span class="o">.</span><span class="n">is_Mul</span><span class="p">:</span>
                <span class="n">arg_</span> <span class="o">=</span> <span class="n">Mul</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="k">if</span> <span class="p">(</span><span class="n">sign</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">else</span>
                             <span class="n">sign</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arg_</span><span class="o">.</span><span class="n">args</span><span class="p">])</span>
            <span class="n">arg_</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">arg_</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arg_</span> <span class="o">=</span> <span class="n">arg</span>
        <span class="k">if</span> <span class="n">arg_</span><span class="o">.</span><span class="n">is_zero</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">re</span><span class="p">(</span><span class="n">arg_</span><span class="p">),</span> <span class="n">im</span><span class="p">(</span><span class="n">arg_</span><span class="p">)</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rv</span><span class="o">.</span><span class="n">is_number</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rv</span><span class="o">.</span><span class="n">atoms</span><span class="p">(</span><span class="n">AppliedUndef</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">rv</span>
        <span class="k">if</span> <span class="n">arg_</span> <span class="o">!=</span> <span class="n">arg</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">arg_</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_eval_derivative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">re</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">im</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">Derivative</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span> <span class="o">*</span>
                <span class="n">Derivative</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_eval_rewrite_as_atan2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">re</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">im</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">atan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span></div>


<div class="viewcode-block" id="conjugate"><a class="viewcode-back" href="../../../../modules/functions/elementary.html#diofant.functions.elementary.complexes.conjugate">[docs]</a><span class="k">class</span> <span class="nc">conjugate</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the complex conjugate of an argument.</span>

<span class="sd">    In mathematics, the complex conjugate of a complex number</span>
<span class="sd">    is given by changing the sign of the imaginary part.</span>

<span class="sd">    Thus, the conjugate of the complex number</span>
<span class="sd">    `a + i b` (where a and b are real numbers) is `a - i b`</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; conjugate(2)</span>
<span class="sd">    2</span>
<span class="sd">    &gt;&gt;&gt; conjugate(I)</span>
<span class="sd">    -I</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.functions.elementary.complexes.sign</span>
<span class="sd">    diofant.functions.elementary.complexes.Abs</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    * https//en.wikipedia.org/wiki/Complex_conjugation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">_eval_conjugate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">_eval_Abs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_eval_adjoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_eval_conjugate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_eval_derivative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">conjugate</span><span class="p">(</span><span class="n">Derivative</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">is_imaginary</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">conjugate</span><span class="p">(</span><span class="n">Derivative</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_eval_transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">adjoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_eval_is_algebraic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_algebraic</span></div>


<div class="viewcode-block" id="transpose"><a class="viewcode-back" href="../../../../modules/functions/elementary.html#diofant.functions.elementary.complexes.transpose">[docs]</a><span class="k">class</span> <span class="nc">transpose</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Linear map transposition.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">_eval_transpose</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">_eval_adjoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">conjugate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_eval_conjugate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">adjoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_eval_transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="adjoint"><a class="viewcode-back" href="../../../../modules/functions/elementary.html#diofant.functions.elementary.complexes.adjoint">[docs]</a><span class="k">class</span> <span class="nc">adjoint</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Conjugate transpose or Hermite conjugation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">_eval_adjoint</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">_eval_transpose</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">conjugate</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_eval_adjoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_eval_conjugate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_eval_transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">conjugate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<span class="c1">###############################################################################</span>
<span class="c1"># ############# HANDLING OF POLAR NUMBERS ################################### #</span>
<span class="c1">###############################################################################</span>


<div class="viewcode-block" id="polar_lift"><a class="viewcode-back" href="../../../../modules/functions/elementary.html#diofant.functions.elementary.complexes.polar_lift">[docs]</a><span class="k">class</span> <span class="nc">polar_lift</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Lift argument to the Riemann surface of the logarithm, using the</span>
<span class="sd">    standard branch.</span>

<span class="sd">    &gt;&gt;&gt; p = Symbol(&#39;p&#39;, polar=True)</span>
<span class="sd">    &gt;&gt;&gt; polar_lift(4)</span>
<span class="sd">    4*exp_polar(0)</span>
<span class="sd">    &gt;&gt;&gt; polar_lift(-4)</span>
<span class="sd">    4*exp_polar(I*pi)</span>
<span class="sd">    &gt;&gt;&gt; polar_lift(-I)</span>
<span class="sd">    exp_polar(-I*pi/2)</span>
<span class="sd">    &gt;&gt;&gt; polar_lift(I + 2)</span>
<span class="sd">    polar_lift(2 + I)</span>

<span class="sd">    &gt;&gt;&gt; polar_lift(4*x)</span>
<span class="sd">    4*polar_lift(x)</span>
<span class="sd">    &gt;&gt;&gt; polar_lift(4*p)</span>
<span class="sd">    4*p</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.functions.elementary.exponential.exp_polar</span>
<span class="sd">    diofant.functions.elementary.complexes.periodic_argument</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">is_polar</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">is_comparable</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Cannot be evalf&#39;d.</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.exponential</span> <span class="k">import</span> <span class="n">exp_polar</span>
        <span class="kn">from</span> <span class="nn">.complexes</span> <span class="k">import</span> <span class="n">arg</span> <span class="k">as</span> <span class="n">argument</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_number</span> <span class="ow">and</span> <span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">is_finite</span> <span class="ow">or</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_extended_real</span><span class="p">):</span>
            <span class="n">ar</span> <span class="o">=</span> <span class="n">argument</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="c1"># In general we want to affirm that something is known,</span>
            <span class="c1"># e.g. `not ar.has(argument) and not ar.has(atan)`</span>
            <span class="c1"># but for now we will just be more restrictive and</span>
            <span class="c1"># see that it has evaluated to one of the known values.</span>
            <span class="k">if</span> <span class="n">ar</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">pi</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">exp_polar</span><span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="n">ar</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Mul</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">args</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">arg</span><span class="p">]</span>
        <span class="n">included</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">excluded</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">positive</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_polar</span><span class="p">:</span>
                <span class="n">included</span> <span class="o">+=</span> <span class="p">[</span><span class="n">arg</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_positive</span><span class="p">:</span>
                <span class="n">positive</span> <span class="o">+=</span> <span class="p">[</span><span class="n">arg</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">excluded</span> <span class="o">+=</span> <span class="p">[</span><span class="n">arg</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">excluded</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">excluded</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Mul</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">included</span> <span class="o">+</span> <span class="n">positive</span><span class="p">))</span><span class="o">*</span><span class="n">polar_lift</span><span class="p">(</span><span class="n">Mul</span><span class="p">(</span><span class="o">*</span><span class="n">excluded</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">included</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Mul</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">included</span> <span class="o">+</span> <span class="n">positive</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Mul</span><span class="p">(</span><span class="o">*</span><span class="n">positive</span><span class="p">)</span><span class="o">*</span><span class="n">exp_polar</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_eval_evalf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Careful! any evalf of polar numbers is flaky &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_eval_evalf</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_eval_Abs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="periodic_argument"><a class="viewcode-back" href="../../../../modules/functions/elementary.html#diofant.functions.elementary.complexes.periodic_argument">[docs]</a><span class="k">class</span> <span class="nc">periodic_argument</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represent the argument on a quotient of the Riemann surface of the</span>
<span class="sd">    logarithm. That is, given a period P, always return a value in</span>
<span class="sd">    (-P/2, P/2], by using exp(P*I) == 1.</span>

<span class="sd">    &gt;&gt;&gt; unbranched_argument(exp(5*I*pi))</span>
<span class="sd">    pi</span>
<span class="sd">    &gt;&gt;&gt; unbranched_argument(exp_polar(5*I*pi))</span>
<span class="sd">    5*pi</span>
<span class="sd">    &gt;&gt;&gt; periodic_argument(exp_polar(5*I*pi), 2*pi)</span>
<span class="sd">    pi</span>
<span class="sd">    &gt;&gt;&gt; periodic_argument(exp_polar(5*I*pi), 3*pi)</span>
<span class="sd">    -pi</span>
<span class="sd">    &gt;&gt;&gt; periodic_argument(exp_polar(5*I*pi), pi)</span>
<span class="sd">    0</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.functions.elementary.exponential.exp_polar</span>
<span class="sd">    diofant.functions.elementary.complexes.polar_lift : Lift argument to the Riemann surface of the logarithm</span>
<span class="sd">    diofant.functions.elementary.complexes.principal_branch</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_getunbranched</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ar</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ar</span><span class="o">.</span><span class="n">is_Mul</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">ar</span><span class="o">.</span><span class="n">args</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">ar</span><span class="p">]</span>
        <span class="n">unbranched</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="o">.</span><span class="n">is_polar</span><span class="p">:</span>
                <span class="n">unbranched</span> <span class="o">+=</span> <span class="n">arg</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">exp_polar</span><span class="p">):</span>
                <span class="n">unbranched</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">as_real_imag</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">is_Pow</span><span class="p">:</span>
                <span class="n">re</span><span class="p">,</span> <span class="n">im</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">as_real_imag</span><span class="p">()</span>
                <span class="n">unbranched</span> <span class="o">+=</span> <span class="n">re</span><span class="o">*</span><span class="n">unbranched_argument</span><span class="p">(</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">base</span><span class="p">)</span> <span class="o">+</span> <span class="n">im</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">base</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">polar_lift</span><span class="p">):</span>
                <span class="n">unbranched</span> <span class="o">+=</span> <span class="n">arg</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="k">return</span> <span class="n">unbranched</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ar</span><span class="p">,</span> <span class="n">period</span><span class="p">):</span>
        <span class="c1"># Our strategy is to evaluate the argument on the Riemann surface of the</span>
        <span class="c1"># logarithm, and then reduce.</span>
        <span class="c1"># NOTE evidently this means it is a rather bad idea to use this with</span>
        <span class="c1"># period != 2*pi and non-polar numbers.</span>
        <span class="kn">from</span> <span class="nn">.integers</span> <span class="k">import</span> <span class="n">ceiling</span>
        <span class="kn">from</span> <span class="nn">.trigonometric</span> <span class="k">import</span> <span class="n">atan2</span><span class="p">,</span> <span class="n">atan</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">period</span><span class="o">.</span><span class="n">is_positive</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">period</span> <span class="o">==</span> <span class="n">oo</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ar</span><span class="p">,</span> <span class="n">principal_branch</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">periodic_argument</span><span class="p">(</span><span class="o">*</span><span class="n">ar</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ar</span><span class="p">,</span> <span class="n">polar_lift</span><span class="p">)</span> <span class="ow">and</span> <span class="n">period</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">periodic_argument</span><span class="p">(</span><span class="n">ar</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">period</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ar</span><span class="o">.</span><span class="n">is_Mul</span><span class="p">:</span>
            <span class="n">newargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ar</span><span class="o">.</span><span class="n">args</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">is_positive</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newargs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ar</span><span class="o">.</span><span class="n">args</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">periodic_argument</span><span class="p">(</span><span class="n">Mul</span><span class="p">(</span><span class="o">*</span><span class="n">newargs</span><span class="p">),</span> <span class="n">period</span><span class="p">)</span>
        <span class="n">unbranched</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_getunbranched</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unbranched</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">unbranched</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">periodic_argument</span><span class="p">,</span> <span class="n">atan2</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">atan</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">period</span> <span class="o">==</span> <span class="n">oo</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">unbranched</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">ceiling</span><span class="p">(</span><span class="n">unbranched</span><span class="o">/</span><span class="n">period</span> <span class="o">-</span> <span class="n">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">period</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">n</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">ceiling</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">unbranched</span> <span class="o">-</span> <span class="n">n</span>

    <span class="k">def</span> <span class="nf">_eval_is_real</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">is_real</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">is_positive</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>


<span class="k">def</span> <span class="nf">unbranched_argument</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">periodic_argument</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">oo</span><span class="p">)</span>


<div class="viewcode-block" id="principal_branch"><a class="viewcode-back" href="../../../../modules/functions/elementary.html#diofant.functions.elementary.complexes.principal_branch">[docs]</a><span class="k">class</span> <span class="nc">principal_branch</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represent a polar number reduced to its principal branch on a quotient</span>
<span class="sd">    of the Riemann surface of the logarithm.</span>

<span class="sd">    This is a function of two arguments. The first argument is a polar</span>
<span class="sd">    number `z`, and the second one a positive real number of infinity, `p`.</span>
<span class="sd">    The result is &quot;z mod exp_polar(I*p)&quot;.</span>

<span class="sd">    &gt;&gt;&gt; principal_branch(z, oo)</span>
<span class="sd">    z</span>
<span class="sd">    &gt;&gt;&gt; principal_branch(exp_polar(2*pi*I)*3, 2*pi)</span>
<span class="sd">    3*exp_polar(0)</span>
<span class="sd">    &gt;&gt;&gt; principal_branch(exp_polar(2*pi*I)*3*z, 2*pi)</span>
<span class="sd">    3*principal_branch(z, 2*pi)</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diofant.functions.elementary.exponential.exp_polar</span>
<span class="sd">    diofant.functions.elementary.complexes.polar_lift : Lift argument to the Riemann surface of the logarithm</span>
<span class="sd">    diofant.functions.elementary.complexes.periodic_argument</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">is_polar</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">is_comparable</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># cannot always be evalf&#39;d</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">period</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">polar_lift</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">principal_branch</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">period</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">period</span> <span class="o">==</span> <span class="n">oo</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">periodic_argument</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">oo</span><span class="p">)</span>
        <span class="n">barg</span> <span class="o">=</span> <span class="n">periodic_argument</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">period</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ub</span> <span class="o">!=</span> <span class="n">barg</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ub</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">periodic_argument</span><span class="p">)</span> \
                <span class="ow">and</span> <span class="ow">not</span> <span class="n">barg</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">periodic_argument</span><span class="p">):</span>
            <span class="n">pl</span> <span class="o">=</span> <span class="n">polar_lift</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">mr</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">polar_lift</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">expr</span>
            <span class="n">pl</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">polar_lift</span><span class="p">,</span> <span class="n">mr</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">pl</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">polar_lift</span><span class="p">):</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">exp_polar</span><span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="p">(</span><span class="n">barg</span> <span class="o">-</span> <span class="n">ub</span><span class="p">))</span><span class="o">*</span><span class="n">pl</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">is_polar</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">exp_polar</span><span class="p">):</span>
                    <span class="n">res</span> <span class="o">*=</span> <span class="n">exp_polar</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">res</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">:</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">as_coeff_mul</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">)</span>
        <span class="n">others</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">is_positive</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">*=</span> <span class="n">y</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">others</span> <span class="o">+=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">others</span><span class="p">)</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="n">periodic_argument</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">period</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">periodic_argument</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_number</span> <span class="ow">and</span> <span class="p">(</span><span class="n">unbranched_argument</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">!=</span> <span class="n">arg</span> <span class="ow">or</span>
                              <span class="p">(</span><span class="n">arg</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">m</span> <span class="o">!=</span> <span class="p">()</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">arg</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">principal_branch</span><span class="p">(</span><span class="n">Mul</span><span class="p">(</span><span class="o">*</span><span class="n">m</span><span class="p">),</span> <span class="n">period</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">principal_branch</span><span class="p">(</span><span class="n">exp_polar</span><span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="n">arg</span><span class="p">)</span><span class="o">*</span><span class="n">Mul</span><span class="p">(</span><span class="o">*</span><span class="n">m</span><span class="p">),</span> <span class="n">period</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_number</span> <span class="ow">and</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">period</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="ow">is</span> <span class="n">S</span><span class="o">.</span><span class="n">true</span> <span class="ow">or</span> <span class="n">arg</span> <span class="o">==</span> <span class="n">period</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> \
                <span class="ow">and</span> <span class="n">m</span> <span class="o">==</span> <span class="p">():</span>
            <span class="k">return</span> <span class="n">exp_polar</span><span class="p">(</span><span class="n">arg</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_eval_evalf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.exponential</span> <span class="k">import</span> <span class="n">exp</span>
        <span class="n">z</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">periodic_argument</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">period</span><span class="p">)</span><span class="o">.</span><span class="n">_eval_evalf</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">pi</span> <span class="ow">or</span> <span class="n">p</span> <span class="o">==</span> <span class="o">-</span><span class="n">pi</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>  <span class="c1"># Cannot evalf for this argument.</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="n">p</span><span class="p">))</span><span class="o">.</span><span class="n">_eval_evalf</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_polarify</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">lift</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">...integrals</span> <span class="k">import</span> <span class="n">Integral</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">eq</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">_polarify</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">lift</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">eq</span><span class="o">.</span><span class="n">args</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">eq</span><span class="o">.</span><span class="n">is_polar</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">eq</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">BooleanAtom</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">eq</span>
    <span class="k">if</span> <span class="n">eq</span><span class="o">.</span><span class="n">is_number</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pause</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">polar_lift</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="p">(</span><span class="n">Dummy</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pause</span> <span class="ow">and</span> <span class="n">lift</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">polar_lift</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">eq</span><span class="o">.</span><span class="n">is_Atom</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">eq</span>
    <span class="k">elif</span> <span class="n">eq</span><span class="o">.</span><span class="n">is_Add</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">_polarify</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">lift</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">eq</span><span class="o">.</span><span class="n">args</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">lift</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">polar_lift</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span>
    <span class="k">elif</span> <span class="n">eq</span><span class="o">.</span><span class="n">is_Function</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">eq</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">_polarify</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">lift</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">eq</span><span class="o">.</span><span class="n">args</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">eq</span><span class="o">.</span><span class="n">is_Pow</span> <span class="ow">and</span> <span class="n">eq</span><span class="o">.</span><span class="n">base</span> <span class="ow">is</span> <span class="n">E</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">eq</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">eq</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="n">_polarify</span><span class="p">(</span><span class="n">eq</span><span class="o">.</span><span class="n">exp</span><span class="p">,</span> <span class="n">lift</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">Integral</span><span class="p">):</span>
        <span class="c1"># Don&#39;t lift the integration variable</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">_polarify</span><span class="p">(</span><span class="n">eq</span><span class="o">.</span><span class="n">function</span><span class="p">,</span> <span class="n">lift</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="n">pause</span><span class="p">)</span>
        <span class="n">limits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">limit</span> <span class="ow">in</span> <span class="n">eq</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">_polarify</span><span class="p">(</span><span class="n">limit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lift</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="n">pause</span><span class="p">)</span>
            <span class="n">rest</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">_polarify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lift</span><span class="o">=</span><span class="n">lift</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="n">pause</span><span class="p">),</span>
                             <span class="n">limit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
            <span class="n">limits</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">var</span><span class="p">,)</span> <span class="o">+</span> <span class="n">rest</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Integral</span><span class="p">(</span><span class="o">*</span><span class="p">((</span><span class="n">func</span><span class="p">,)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">limits</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">eq</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">_polarify</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">lift</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="n">pause</span><span class="p">)</span>
                         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Expr</span><span class="p">)</span> <span class="k">else</span> <span class="n">arg</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">eq</span><span class="o">.</span><span class="n">args</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">polarify</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lift</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Turn all numbers in eq into their polar equivalents (under the standard</span>
<span class="sd">    choice of argument).</span>

<span class="sd">    Note that no attempt is made to guess a formal convention of adding</span>
<span class="sd">    polar numbers, expressions like 1 + x will generally not be altered.</span>

<span class="sd">    Note also that this function does not promote exp(x) to exp_polar(x).</span>

<span class="sd">    If ``subs`` is True, all symbols which are not already polar will be</span>
<span class="sd">    substituted for polar dummies; in this case the function behaves much</span>
<span class="sd">    like posify.</span>

<span class="sd">    If ``lift`` is True, both addition statements and non-polar symbols are</span>
<span class="sd">    changed to their polar_lift()ed versions.</span>
<span class="sd">    Note that lift=True implies subs=False.</span>

<span class="sd">    &gt;&gt;&gt; expr = (-x)**y</span>
<span class="sd">    &gt;&gt;&gt; expr.expand()</span>
<span class="sd">    (-x)**y</span>
<span class="sd">    &gt;&gt;&gt; polarify(expr)[0]</span>
<span class="sd">    (_x*exp_polar(I*pi))**_y</span>
<span class="sd">    &gt;&gt;&gt; sorted(polarify(expr)[1].items(), key=default_sort_key)</span>
<span class="sd">    [(_x, x), (_y, y)]</span>
<span class="sd">    &gt;&gt;&gt; polarify(expr)[0].expand()</span>
<span class="sd">    _x**_y*exp_polar(I*pi*_y)</span>
<span class="sd">    &gt;&gt;&gt; polarify(x, lift=True)</span>
<span class="sd">    polar_lift(x)</span>
<span class="sd">    &gt;&gt;&gt; polarify(x*(1+y), lift=True)</span>
<span class="sd">    polar_lift(x)*polar_lift(y + 1)</span>

<span class="sd">    Adds are treated carefully:</span>

<span class="sd">    &gt;&gt;&gt; polarify(1 + sin((1 + I)*x))</span>
<span class="sd">    (sin(_x*polar_lift(1 + I)) + 1, {_x: x})</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">lift</span><span class="p">:</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">eq</span> <span class="o">=</span> <span class="n">_polarify</span><span class="p">(</span><span class="n">sympify</span><span class="p">(</span><span class="n">eq</span><span class="p">),</span> <span class="n">lift</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">subs</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">eq</span>
    <span class="n">reps</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="n">Dummy</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">polar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">eq</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">}</span>
    <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">reps</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">eq</span><span class="p">,</span> <span class="p">{</span><span class="n">r</span><span class="p">:</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reps</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>


<span class="k">def</span> <span class="nf">_unpolarify</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">exponents_only</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">or</span> <span class="n">eq</span><span class="o">.</span><span class="n">is_Atom</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">eq</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">pause</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">exp_polar</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">exp</span><span class="p">(</span><span class="n">_unpolarify</span><span class="p">(</span><span class="n">eq</span><span class="o">.</span><span class="n">exp</span><span class="p">,</span> <span class="n">exponents_only</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">principal_branch</span><span class="p">)</span> <span class="ow">and</span> <span class="n">eq</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_unpolarify</span><span class="p">(</span><span class="n">eq</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">exponents_only</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">eq</span><span class="o">.</span><span class="n">is_Add</span> <span class="ow">or</span> <span class="n">eq</span><span class="o">.</span><span class="n">is_Mul</span> <span class="ow">or</span> <span class="n">eq</span><span class="o">.</span><span class="n">is_Boolean</span> <span class="ow">or</span>
            <span class="n">eq</span><span class="o">.</span><span class="n">is_Relational</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="n">eq</span><span class="o">.</span><span class="n">rel_op</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">eq</span><span class="o">.</span><span class="n">args</span> <span class="ow">or</span>
                <span class="n">eq</span><span class="o">.</span><span class="n">rel_op</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">))</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">eq</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">_unpolarify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">exponents_only</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">eq</span><span class="o">.</span><span class="n">args</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">polar_lift</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_unpolarify</span><span class="p">(</span><span class="n">eq</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">exponents_only</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">eq</span><span class="o">.</span><span class="n">is_Pow</span> <span class="ow">and</span> <span class="n">eq</span><span class="o">.</span><span class="n">base</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">E</span><span class="p">:</span>
        <span class="n">expo</span> <span class="o">=</span> <span class="n">_unpolarify</span><span class="p">(</span><span class="n">eq</span><span class="o">.</span><span class="n">exp</span><span class="p">,</span> <span class="n">exponents_only</span><span class="p">)</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">_unpolarify</span><span class="p">(</span><span class="n">eq</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="n">exponents_only</span><span class="p">,</span>
                           <span class="ow">not</span> <span class="p">(</span><span class="n">expo</span><span class="o">.</span><span class="n">is_integer</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pause</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">base</span><span class="o">**</span><span class="n">expo</span>
    <span class="k">elif</span> <span class="n">eq</span><span class="o">.</span><span class="n">is_Pow</span> <span class="ow">and</span> <span class="n">eq</span><span class="o">.</span><span class="n">base</span> <span class="ow">is</span> <span class="n">E</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">exp</span><span class="p">(</span><span class="n">_unpolarify</span><span class="p">(</span><span class="n">eq</span><span class="o">.</span><span class="n">exp</span><span class="p">,</span> <span class="n">exponents_only</span><span class="p">,</span> <span class="n">exponents_only</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">eq</span><span class="o">.</span><span class="n">is_Function</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">eq</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="s1">&#39;unbranched&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">eq</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">_unpolarify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">exponents_only</span><span class="p">,</span> <span class="n">exponents_only</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">eq</span><span class="o">.</span><span class="n">args</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">eq</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">_unpolarify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">exponents_only</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">eq</span><span class="o">.</span><span class="n">args</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">unpolarify</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="p">{},</span> <span class="n">exponents_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If p denotes the projection from the Riemann surface of the logarithm to</span>
<span class="sd">    the complex line, return a simplified version eq&#39; of `eq` such that</span>
<span class="sd">    p(eq&#39;) == p(eq).</span>
<span class="sd">    Also apply the substitution subs in the end. (This is a convenience, since</span>
<span class="sd">    ``unpolarify``, in a certain sense, undoes polarify.)</span>

<span class="sd">    &gt;&gt;&gt; unpolarify(polar_lift(I + 2))</span>
<span class="sd">    2 + I</span>
<span class="sd">    &gt;&gt;&gt; unpolarify(sin(polar_lift(I + 7)))</span>
<span class="sd">    sin(7 + I)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">eq</span>

    <span class="n">eq</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">subs</span> <span class="o">!=</span> <span class="p">{}:</span>
        <span class="k">return</span> <span class="n">unpolarify</span><span class="p">(</span><span class="n">eq</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">subs</span><span class="p">))</span>
    <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pause</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">exponents_only</span><span class="p">:</span>
        <span class="n">pause</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">while</span> <span class="n">changed</span><span class="p">:</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">_unpolarify</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">exponents_only</span><span class="p">,</span> <span class="n">pause</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="n">eq</span><span class="p">:</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">eq</span> <span class="o">=</span> <span class="n">res</span>
    <span class="c1"># Finally, replacing Exp(0) by 1 is always correct.</span>
    <span class="c1"># So is polar_lift(0) -&gt; 0.</span>
    <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">exp_polar</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="n">polar_lift</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="mi">0</span><span class="p">})</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2006-2018 SymPy Development Team, 2013-2018 Sergey B Kirpichev

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>